<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>wview User Manual</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body>
<a href="#topofpage"></a>
<h1 align="center">wview User Manual</h1>
<p align="center">Nov. 12, 2009</p>

<p align="left">
<h2><strong>Contents</strong></h2><br>
1. <a href="#1. Overview">Overview</a><br>
2. <a href="#2. Distribution Contents">Distribution Contents</a><br>
3. <a href="#3. Prerequisites">Prerequisites</a><br>
4. <a href="#4. Build and Install">Build and Install</a><br>
5. <a href="#5. Cross Compiling">Cross Compiling</a><br>
6. <a href="#6. Configuration">Configuration</a><br>
7. <a href="#7. Weather Station Configuration">Weather Station Configuration</a><br>
7.1 <a href="#7.1 Station Simulator">Station Simulator</a><br>
7.2 <a href="#7.2 Davis Vantage Pro/Pro2 Console">Davis Vantage Pro/Pro2 Console</a><br>
7.3 <a href="#7.3 Vaisala WXT510">Vaisala WXT510</a><br>
7.4 <a href="#7.4 La Crosse WS-2300 Series">La Crosse WS-2300 Series</a><br>
7.5 <a href="#7.5 Oregon Scientific WMR918 Series">Oregon Scientific WMR918 Series</a><br>
8. <a href="#8. Metric Units and Internationalization">Metric Units and Internationalization</a><br>
9. <a href="#9. Run Environment Description">Run Environment Description</a><br>
10. <a href="#10. Configuration Files Description">Configuration Files Description</a><br>
11. <a href="#11. Using a MySQL or PostgreSQL Server to Store Data">Using a MySQL or PostgreSQL Server to Store Data</a><br>
12. <a href="#12. Setting Up FTP Transfers">Setting Up FTP Transfers</a><br>
13. <a href="#13. Alarms and wview As a Data Feed Engine">Alarms and wview As a Data Feed Engine</a><br>
14. <a href="#14. Secure File Transfer (rsync/ssh)">Secure File Transfer (rsync/ssh)</a><br>
15. <a href="#15. Miscellaneous">Miscellaneous</a><br>
16. <a href="#16. CWOP - Submitting Your Data to NOAA and the CWOP System">CWOP - Submitting Your Data to NOAA and the CWOP System</a><br>
17. <a href="#17. Wunderground/Weatherforyou - Submitting Your Data to Weather Underground and/or Weatherforyou">Wunderground/Weatherforyou - Submitting Your Data to Weather Underground and/or Weatherforyou</a><br>
18. <a href="#18. AWEKAS - Providing Your Data to Awekas">AWEKAS - Providing Your Data to Awekas</a><br>
19. <a href="#19. Using a Linksys NSLU2 as the wview Host">Using a Linksys NSLU2 as the wview Host</a><br>
20. <a href="#20. Porting New Stations To wview">Porting New Stations To wview</a><br>
21. <a href="#21. Sensor Calibration">Sensor Calibration</a><br>
22. <a href="#22. Data Stored in SQLite3 (And How to Use It)">Data Stored in SQLite3 (And How to Use It)</a><br>
23. <a href="#23. wviewmgmt - The New Way to Manage wview">wviewmgmt - The New Way to Manage wview</a><br>
24. <a href="#24. Troubleshooting">Troubleshooting</a><br><br>
</p>


<a name="1. Overview"></a>
<hr size=2 noshade>
<h2>1. Overview</h2>
wview is a collection of linux/unix daemons which interface with a supported 
weather station to retrieve archive records (if generated by the station) and 
current conditions. The stations currently supported are:<br>
Davis Vantage Pro/Pro2<br>
Vaisala WXT510<br>
La Crosse WS-23XX<br>
Oregon Scientific WMR9X8/WMR928N<br>
<br>
If the station does not generate archive records internally, wview will auto-generate 
archive records based on the sensor readings collected for that interval. The 
archive records are stored in the Davis WLK file format (thus Weatherlink-generated 
archive files can often be used by wview). At a configurable interval, wview will 
utilize the archive history and current conditions to generate weather images 
(buckets, dials and graphs) and HTML web pages based on user-configurable HTML 
templates.<br><br>

Features:<br>
<ul>
  <li>24x7x365 reliability.</li>
  <li>Fast image and HTML/XML file generation.</li>
  <li>Non-GUI, headless, lightweight (size and resources).</li>
  <li>Embeddable - can be deployed on low-power embedded systems such as the Linksys 
      NSLU2.</li>
  <li>Multi-Lingual - HTML/XML templates, labels and text.</li>
  <li>US (Imperial) or Metric Units - can be easily configured for metric or US units
      of measure.</li>
  <li>SQLite Archive Storage - archive data is stored in an SQLite3 relational database.</li>
  <li>Remote Upload - web pages and images can be transferred to a remote web server 
      via an ftp or secure ssh process included with wview.</li>
  <li>Alarms - the wview alarm daemon wvalarmd can be enabled to deliver current 
      conditions to TCP socket clients as a near real-time data feed engine. wvalarmd 
      can also be configured to function as a weather data alarm generator to user 
      specified scripts or binaries.</li>
  <li>CWOP - can be configured to submit data to CWOP.</li>
  <li>Wunderground - can be configured to submit data to Wunderground.</li>
  <li>Awekas - can be configured to submit data to Awekas.</li>
  <li>Weatherforyou - can be configured to submit data to Weatherforyou.</li>
  <li>RSS Feeds - processes XML template files and includes a default weather data 
      RSS feed template.</li>
</ul>

<br>
<a name="2. Distribution Contents"></a>
<hr size=2 noshade>
<h2>2. Distribution Contents</h2>
<table align="center" border="0" width="100%">
<tbody>
  <tr>
    <td align="left" width="30%">
	  /stations/common
	</td>
	<td align="left" width="70%">
	  Source directory for the station daemon
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /stations/VantagePro
	</td>
	<td align="left" width="70%">
	  Source directory for the Davis Vantage Pro/Pro2 interface
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /stations/Simulator
	</td>
	<td align="left" width="70%">
	  Source directory for the station simulator
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /stations/WXT510
	</td>
	<td align="left" width="70%">
	  Source directory for the Vaisala WXT510 interface
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /stations/WS-2300
	</td>
	<td align="left" width="70%">
	  Source directory for the La Crosse WS-23XX interface
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /stations/WMR918
	</td>
	<td align="left" width="70%">
	  Source directory for the Oregon Scientific WMR9X8 interface
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /htmlgenerator
	</td>
	<td align="left" width="70%">
	  Source directory for the file generator
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /common
	</td>
	<td align="left" width="70%">
	  Common source and build files
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /wviewmgmt
	</td>
	<td align="left" width="70%">
	  Source directory for the wview management web site
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /examples/conf
	</td>
	<td align="left" width="70%">
	  Example config files (see description below)
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /examples/html/classic
	</td>
	<td align="left" width="70%">
	  Example HTML template files and tag description file parameters.txt 
	  (see description below)
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /examples/html/chrome
	</td>
	<td align="left" width="70%">
	  Example HTML template files and tag description file parameters.txt 
	  (see description below)
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /utilities/archive-be2le
	</td>
	<td align="left" width="70%">
	  Source directory for the wview archive directory Big-Endian to 
      Little-Endian command line convertor
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /utilities/archive-le2be
	</td>
	<td align="left" width="70%">
	  Source directory for the wview archive directory Little-Endian to 
      Big-Endian command line convertor
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /utilities/wlk2sqlite
	</td>
	<td align="left" width="70%">
	  Source directory for the wview WLK to SQLite3 archive convertor
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /utilities/sqlite2wlk
	</td>
	<td align="left" width="70%">
	  Source directory for the wview SQLite3 to WLK archive convertor
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /configure
	</td>
	<td align="left" width="70%">
	  build configuration script to be executed before building wview
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /cross-compile
	</td>
	<td align="left" width="70%">
	  Contains example configure scripts for cross compilation. libz, libpng, 
	  libgd, librad and wview scripts are included (and should be built in that
      order). Use these scripts instead of "./configure" to configure these 
	  libraries for cross compilation. These scripts configure for arm-linux
      targets but could easily be edited for a different target.
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /scripts
	</td>
	<td align="left" width="70%">
	  Contains example helper scripts for wview installation and update.
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /ChangeLog
	</td>
	<td align="left" width="70%">
	  The release notes file
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /wview-User-Manual.html
	</td>
	<td align="left" width="70%">
	  This file, the User Manual
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /wview-Quick-Start.html
	</td>
	<td align="left" width="70%">
	  Quick Start Guide
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /wview-Quick-Start-MacOSX.html
	</td>
	<td align="left" width="70%">
	  MacOSX-specific Quick Start Guide
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /wview-Quick-Start-Debian.html
	</td>
	<td align="left" width="70%">
	  Debian-specific Quick Start Guide
	</td>
  </tr>
  <tr>
    <td align="left" width="30%">
	  /UPGRADE
	</td>
	<td align="left" width="70%">
	  Notes on upgrading from previous versions
	</td>
  </tr>
</tbody>
</table>

<br><br>
<a name="3. Prerequisites"></a>
<hr size=2 noshade>
<h2>3. Prerequisites</h2>
<h3><u>Libraries</u></h3>
<pre>
  Note: Some of these libraries may be represented as "-dev" or similar in your 
        package management utility, i.e., "libcurl-dev". If they are, you should install
        the dev version in order to get the development libraries that radlib/wview needs.
</pre>
<ul>
  <li>
    <strong>libz</strong> - compression library
  </li>
  <li>
    <strong>libpng</strong> - png image library
  </li>
  <li>
    <strong>libreadline5-dev</strong> - readline library
  </li>
  <li>
    <strong>gawk</strong> - gnu pattern processing language
  </li>
  <li>
    <strong>libsqlite3</strong> - SQLite3 database run time library - make sure 
    the older version (2.x.y) is not installed - it may be named libsqlite0 
    (debian, kubuntu) or some other package name - you can only 
    have SQLite3 libraries and development environment installed
  </li>
  <li>
    <strong>libsqlite3-dev</strong> - SQLite3 database development library - 
    make sure the older version (2.x.y) is not installed - it may be 
    named libsqlite0-dev (debian, kubuntu) or some other package name - you can only 
    have SQLite3 libraries and development environment installed
  </li>
  <li>
    <strong>sqlite3</strong> - SQLite3 database command line utility
  </li>
  <li>
    <strong>libgd2</strong> - graphics drawing library - may require installation -
	<a href="http://www.boutell.com/gd/">http://www.boutell.com/gd/</a>
  </li>
  <li>
    <strong>radlib</strong> - rapid application development library - 
    must be installed with SQLite support (--enable-sqlite) -
	<a href="http://www.radlib.teel.ws">http://www.radlib.teel.ws</a>
  </li>
  <li>
    <strong>libssl</strong> - secure socket library - optional, required for libcurl
  </li>
  <li>
    <strong>libcurl</strong> - "C" URL HTTP library - optional, required for Weather Underground or Weatherforyou -
	<a href="http://curl.haxx.se/libcurl/">http://curl.haxx.se/libcurl/</a>
  </li>
  <li>
    <strong>sendmail</strong> - email transfer agent - optional, required for email alerts
  </li>
  <li>
    <strong>sendEmail</strong> - command line email sending utility - optional, required for email alerts
  </li>
  <li>
    <strong>mysql-client</strong> - MySQL client utilities (including mysqlimport) - optional, required for MySQL exports
  </li>
</ul>
<h3><u>System</u></h3>
<ul>
  <li>
    <strong>ntp/xntp</strong> - Network Time Protocol - a configured and functional NTP
    daemon should be enabled on the host system to keep system and weather 
	station time accurate and in sync
  </li>
  <li>
    <strong>apache</strong> - in order to serve your weather site to the world, 
	an http server is required - other http servers will work too. If you are 
	going to export your site to another server or to your ISP account site, 
	then an http server is not required on the wview server.
  </li>
  <li>
    <strong>php5 and php5-sqlite3</strong> - optionally needed for browser-based 
    configuration (requires apache or similar)
  </li>
  <li>
    <strong>Serial/Ethernet/USB port</strong> - an available interface port 
	is required to connect to the Weather Station<br><br>
    <ul>
      <li>Serial</li>
      <li>Ethernet - a terminal server or ethernet to serial server is required - 
          set up as decribed above for the serial port and configured in transparent 
          data mode (no control character processing) with no packet delimiter. 
          wview allows you to specify the hostname and port of your serial server. 
          The <a href="http://www.neteon.net/">Neteon</a> GW21E, Lantronix MSS1-T 
          and Xyplex Maxserver 1600 have been confirmed to work with wview. See 
          the <a href="#15. Miscellaneous">Miscellaneous</a> section for my 
          configuration notes on the GW21E and the MSS1-T.</li>
      <li>USB</li>
    </ul>
  </li>
</ul>
<h3><u>Weather Station - one of the following:</u></h3>
<ul>
  <li>
    <strong>Vantage Pro or Vantage Pro2 Weather Station with Console</strong><br> 
      <ul>
        <li>
          <strong>WeatherLink for Vantage Pro or Pro2, Windows, Serial or USB</strong> - 
          the windows software is not required, but this is the only way to obtain the 
          serial or USB data logger
        </li>
      </ul>
  </li>
  <li>
    <strong>Vaisala WXT510</strong><br> 
  </li>
  <li>
    <strong>La Crosse WS-2300 Series</strong><br> 
  </li>
  <li>
    <strong>Oregon Scientific WMR918/928N/968 Series</strong><br> 
  </li>
  <li>
    <strong>Station Simulator (for demos and testing)</strong><br> 
  </li>
  <li>
    <!-- New Station -->
  </li>
</ul>

<br><br>
<a name="4. Build and Install"></a>
<hr size=2 noshade>
<h2>4. Build and Install</h2>
<pre>
   Select one of the following methods based on your OS/distribution.

4.1  Debian and Derivatives (ubuntu, kubuntu, xubuntu)

     Use the scripts/wview-install-debian script. It is also available at:
     <a href="http://sourceforge.net/projects/wview/files/wview/wview-install-debian/download">wview-install-debian</a>

     It will install all prerequisites (via apt-get) and the latest wview.

4.2  Mac OSX >= 10.4

4.2.1  Install XCode for your OSX version: 
       <a href="https://connect.apple.com/cgi-bin/WebObjects/MemberSite.woa/wa/getSoftware?bundleID=20505">Download XCode</a>

4.2.2  Install MacPorts: <a href="http://distfiles.macports.org/MacPorts/">Download MacPorts</a>

4.2.3  Execute the following from the command line:
       > sudo port -d selfupdate
       > sudo port install wview

       This will install all prerequisites and wview.

4.3  Manual Installation

4.3.1  Extract in the location [wview_bld_path] of your choosing:
       > cd [wview_bld_path]
       > tar zxvf wview-x.y.z.tar.gz

4.3.2  Change directory to the wview root source directory:
       > cd [wview_bld_path/wview-x.y.z]

4.3.3  Run the configure script to create the build files for your platform:

     Note: If the environment variable HTTP_DOC_ROOT is defined prior to 
           invocation of the configure script, the install target will 
           install wviewmgmt (The Web Management Tool) to the http document 
           root specified.

     Note: [station_enable_str] refers to the appropriate enable string in the
           list of stations in the previous section *for your station*.

     => Possible Configuration Arguments:

     [station_enable_str] - one of:
         [none] --enable-station-vpro is default
         --enable-station-vpro
         --enable-station-wxt510
         --enable-station-ws2300
         --enable-station-wmr918
         --enable-station-sim
     
     Optional HTTP Services Support - one of:
         [none] No Wunderground/Weatherforyou support (default)
         --enable-http


     => Examples:

     [(default)]
       > HTTP_DOC_ROOT=/var/www ./configure [station_enable_str]

     [Wunderground]
       > HTTP_DOC_ROOT=/var/www/weather ./configure [station_enable_str] --enable-http


     => Note:

     Execute "./configure --help" to see user configurable options. Be careful
     changing any of the prefix values, this has an effect on wview 
     configuration.

4.3.4  Build:
       > make

4.3.5  Install:
       > sudo make install
    
Note: The following build targets are available:
    make                - default target builds all source
    make clean          - deletes binaries and object files
    make install        - makes "default" then installs the binaries to 
                          ${exec-prefix}/bin (usually /usr/local/bin); copies 
                          example config files and run environment (from .../bin) 
                          to $prefix/etc/wview and $prefix/var/wview respectively, 
                          preserving existing data files and configuration if they
                          already exist

4.3.6  Configure to run at system boot (if new install):
     Select the appropriate wview run script - 
     wview-x.y.z/examples/SuSE|RedHat|FreeBSD|FedoraCore|Debian|NSLU2 (based on your OS/distro)
      
     Copy it to the proper location for your system:
         SuSE:       cp wview-x.y.z/examples/SuSE/wview /etc/init.d
         FreeBSD:    cp wview-x.y.z/examples/FreeBSD/wview /etc/rc.d
         FedoraCore: cp wview-x.y.z/examples/FedoraCore/wview /etc/rc.d/init.d
         Debian:     cp wview-x.y.z/examples/Debian/wview /etc/init.d
   
     Make sure it is executable:
         SuSE:       chmod +x /etc/init.d/wview
         FreeBSD:    chmod +x /etc/rc.d/wview
         FedoraCore: chmod +x /etc/rc.d/init.d/wview
         Debian:     chmod +x /etc/init.d/wview
       
     Create a symbolic link in the runlevel directory you boot your server:

         Fedora/Redhat to boot into runlevel 3: 
             > cd /etc/rc.d/rc3.d
             > ln -s ../init.d/wview S98wview
    
         Debian/ubuntu:
             > update-rc.d wview defaults 99
    
         Other distros will be some variation of this.

         wview will now be started when the system is booted.
         Note: You can start/stop wview using this run script:
             > /etc/init.d/wview start   *or*
             > /etc/init.d/wview stop

     Run Script Notes:
     
     1) These are example scripts - ergo their location in the distro under the 
        examples directory. Don't be afraid to edit the appropriate one for your 
        system to your configuration and install location.

     2) Whatever "--prefix" you select during the configure step (default = 
        /usr/local), the wview start scripts are automatically updated to include
        the proper prefix for binary file and run directories.

     3) You should use the same "--prefix=xxx" specification when configuring 
        radlib and wview. Further, this should be the default install location 
        for libraries and library headers in your system - i.e., prefix/lib and 
        prefix/include for libgd2.a, libpng.a, libz.a and gd.h respectively. Do 
        not select a non-default prefix (/usr/local) randomly.

4.3.7  Add radlib location to shared library cache:
     If you get errors similar to:
        /usr/local/bin/wviewd: error while loading shared libraries: 
        librad.so.0: cannot open shared object file: No such file or directory
     you need to either copy the latest wview start script from the distro
     (examples/<your_distro>/wview) to your start script location (see the 
     preceeding section), or add the radlib shared library location 
     (/usr/local/lib) to your shared library cache (see /etc/ld.so.conf) and run
     ldconfig.
</pre>

<br><br>
<a name="5. Cross Compiling"></a>
<hr size=2 noshade>
<h2>5. Cross Compiling</h2>
<pre>
See the scripts in /cross-compile for "./configure" alternatives.
This directory contains example configure scripts for cross compilation. libz,
libpng, libgd, librad and wview scripts are included (and should be built in 
that order). Use these scripts instead of "./configure" to configure these 
libraries for cross compilation. These scripts configure for arm-linux 
targets but can be edited for other targets.

Note: The config-radlib-arm-linux and config-wview-arm-linux scripts will accept 
      up to 3 additional configure options.

The general build sequence is:

> ./config-[pkgname]-arm-linux
> make
[become root]
> make install

All libs and applications are installed in the toolchain root, defined in the 
config scripts.

The general build order is:

libz
libpng
libgd2
libreadline5
libsqlite
librad
wview
</pre>

<br><br>
<a name="6. Configuration"></a>
<hr size=2 noshade>
<h2>6. Configuration</h2>
<pre>
Note: See the appropriate station configuration section  <a href="#7. Weather Station Configuration">7. Weather Station Configuration</a>
      for a procedure to configure your weather station prior to running wview for 
      the first time.

Note: See the <a href="#10. Configuration Files Description">Configuration Files Description</a> and <a href="#9. Run Environment Description">Run Environment Description</a> 
      sections for detailed information concerning files and directories mentioned here.

6.1  (Mandatory) Read the distro (or online) version of the file UPGRADE.

6.2  (Mandatory) Configure wview

     Use one of the following methods:

6.2.1  Web Access ($distro/wviewmgmt)
       The wview SQLite3 configuration database can be updated using a browser and 
       hosting an http server on the wview server. The directory $distro/wviewmgmt
       provides a web interface for wview configuration. The default password is 
       "wview". See the section on the wviewmgmt Manager for setup and use details.

6.2.2  wviewconfig 
       The wview SQLite3 configuration database can be updated using the configure 
       script "wviewconfig". This script asks questions interactively then updates 
       (backing up the existing file) the file $prefix/etc/wview/wview-conf.sdb based 
       on the answers. It uses your previous settings as the default selections where 
       appropriate. It will also allow interactive enabling/disabling of optional wview 
       capabilities such as alarms or file transfer via ftp or ssh. See the relevant 
       sections of this manual for details concerning configuration of the optional 
       capabilities.
       wviewconfig can be safely used for existing installs. It uses the current 
       settings as the default choices, so you don't have to remember what your 
       prior settings were. It will also allow the configuration of new wview 
       optional capabilities while remaining backward compatible with all versions 
       of wview since the 1.0.0 release.

6.3  (Mandatory) Run the wviewhtmlconfig Script

     Customizing HTML Templates For Your Site

     Note: Changing HTML templates in $prefix/etc/wview/html does not require a restart
           of wview. The changes you make will take effect at the next htmlgend
           generation cycle.
     Note: Changing the config files images.conf, images-user.conf,
           html-templates.conf and (if supported) forecast.conf does not require 
           a restart of wview (as of version 3.1.0), but does require a HUP signal 
           to be sent to htmlgend to cause these files to be re-read. Do this as
           follows (this will also toggle log verbosity):

               sudo kill -s HUP `cat $prefix/var/wview/htmlgend.pid`

     As of version 3.5.0, a new configuration script for template setup has been
     added: wviewhtmlconfig.  You should run this first to configure which site
     skin you want to use and to setup the default imperial or metric graphics.
     To run it (as root) enter "wviewhtmlconfig" at the command line, it is interactive
     and will save your old $prefix/etc/wview/html directory to $prefix/etc/wview/html-DATE.TIME.
     As wview users contribute new skins they will be added to the wview distribution
     and supported by the wviewhtmlconfig script.

     HTML template files (in $prefix/etc/wview/html) should be customized to your language and 
     your design preferences. The configuration file html-templates.conf specifies the 
     template files to be used for generation. You may add or remove from this list as 
     needed.
	 
     Edit copies placed in $prefix/etc/wview/html directory, either by use of the "wviewhtmlconfig" 
     script or manually copied for upgrades.
     
     The HTML tags "!--stationCity--" and "!--stationState--" should not be removed 
     from template files for which you want the station location included. wview will 
     replace these tags with the values you specify for "STATION_CITY" and "STATION_STATE" 
     in $prefix/etc/wview/wview-conf.sdb.
     
     The default wview "skin" is provided in the distribution at:
     examples/html/classic. For information on creating your own skin, see the file
     "examples/html/Template-Skins-HOWTO.txt".
     
     The default configuration supports different homepage templates based on day or night. 
     These templates are "index-day.htx" and "index-night.htx" in 
     $prefix/etc/wview/html-templates.conf. If you want one standard homepage template INSTEAD 
     of day/night templates, uncomment "index.htx" and comment the day/night templates
     in the $prefix/etc/wview/html-templates.conf file. See the example html-templates.conf file 
     in the distro for more details. You may either create soft links to the day and 
     night templates you want to use in $prefix/etc/wview/html 
     (ln -s index-clouds.htx index-day.htx), or copy the files you want to 
     index-day.htx and index-night.htx.
     
     There is now support for XML file generation. XML templates should be named
     "*.xtx" and placed in $prefix/etc/wview/html. An example RSS feed template is 
     included in the distro: examples/html/wxrss.xtx. An href to it is included
     in all home page template examples so the RSS feed may be discovered while 
     visiting your home page. wxrss.xtx should be edited for your site when placed 
     in $prefix/etc/wview/html either manually or via "make install".
     
     There is now support for "generic" template file types. For any template
     file named "example.[ext]x" and listed in html-templates.conf, wview will 
     generate a file named "example.[ext]". For example, "myscript.phpx" listed
     in html-templates.conf and found in $prefix/var/wview/html will have all wview 
     tags replaced and the resulting file will be named "myscript.php". Please 
     note that if you are using FTP to transfer your files you will need to add 
     rules for any new extensions you want to support in the wview-conf.sdb database.

     There is support for two new html tags - forecast rule and forecast icon.
     The new tags are !--forecastRule-- and !--forecastIcon-- (brackets omitted) 
     respectively.
     The configuration file forecast.conf allows the user to define the icon 
     files and text associated with the forecast rules. See the example 
     forecast.conf file for details. The icon tag will be replaced by an image 
     html construct pointing at the appropriate icon image file. The rule tag will 
     be replaced by the corresponding text string defined in forecast.conf. 
     Because these capabilities require 35 KB or more of memory (and I think the 
     VP forecasts are hokey), they are disabled by default.

     There is now support for html template macro file inclusion in html template
     files. The new meta-tag is !--include filename.xxx-- (brackets omitted). Any
     template macro file that is to be included in one or more html templates should
     be listed BEFORE any templates including it in the $prefix/etc/wview/html-templates.conf
     configuration file. There is no restriction on the levels of inclusion, just be 
     sure you specify macro templates early in the html-templates.conf file.
     
     Note that you can create any page template design you like - the file 
     examples/html/parameterlist.txt contains a list of all html tags supported by wview. 
     These tags are replaced by the actual data when the html page is generated by wview.

6.4  (New Installs) Existing Weatherlink Archive Files

     If you have existing archive files (*.wlk) that you want to import, use the new
     wlk2sqlite utility to import all archive records into the SQLite3 database
     prior to starting wview. It will find them and use them for historical charts 
     and NOAA reports. Be sure they were collected using the same archive interval 
     that you are going to use for your VP with wview. See the section 
     <a href="#7.2 Davis Vantage Pro/Pro2 Console">Preparing a New Vantage Pro Console</a> for more details.
     
     Note: If you need to convert archive files from big endian to little endian,
           use the arc_be2le utility (specifying source and destination directories).
           This will convert all WLK files in the source 
           directory and place them in the destination directory specified. Folks
           moving from a PPC-based Mac to a PC host (for example) would need to do 
           this conversion on their existing archive directory.
     Note: If you need to convert archive files from little endian to big endian,
           use the arc_le2be utility (specifying source and destination directories).
           This will convert all WLK files in the source 
           directory and place them in the destination directory specified. Folks
           moving from a PC host to an NSLU2 embedded host or a PPC-based Mac 
           (for example) would need to do this conversion on their existing archive 
           directory.
     Note: Execution of wlk2sqlite may require modifying the dynamic library load
           path, i.e.:
           >export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
           You'll know you need this if trying to execute wlk2sqlite produces the 
           following message:
           *wlk2sqlite: error while loading shared libraries: librad.so.0: 
            cannot open shared object file: No such file or directory*
           ... or similar message.

6.5  (Optional) Alarms or Weather Data Feeds

     If weather data alarm processing and/or TCP stream socket server for data 
     feeds is desired, edit $prefix/etc/wview/wview-conf.sdb - changing to fit your requirements.
     See <a href="#13. Alarms and wview As a Data Feed Engine">Alarms and wview As a Data Feed Engine</a> for details.

6.6  (Optional) FTP File Transfer

     If ftp of files to a remote host is desired, edit the wview configuration database
     $prefix/etc/wview/wview-conf.sdb - changing to fit your environment.
     See <a href="#12. Setting Up FTP Transfers">Setting Up FTP Transfers</a> for details.

6.7  (Optional) Secure rsync Remote Synchronization

     If secure rsync synchronization of files to a remote host is desired, edit the 
     wview configuration database $prefix/etc/wview/wview-conf.sdb - changing to 
     fit your environment. 
     See <a href="#14. Secure File Transfer (rsync/ssh)">Secure File Transfer (rsync/ssh)</a> for details.

6.8  Date Formats in Images and Generated Files

     The format of the date in images and generated files can now be defined in 
     $prefix/etc/wview/wview-conf.sdb.
     Prior to version 3.2.2 the date format was fixed depending on whether US or metric units were used.
     Valid formats are those allowed by strftime(3).

6.9  Pre/Post-Generation Scripts

     The script file $prefix/etc/wview/pre-generate.sh (if it exists) will 
     be executed by the htmlgend daemon immediately before the generation of all images 
     and templates.  The script file $prefix/etc/wview/post-generate.sh (if it exists) will 
     be executed by the htmlgend daemon immediately following the generation of all images 
     and templates. This can be used to perform custom transformations of generated images 
     or files. It should NOT be used to perform network tasks such as FTP or other tasks
     which may block and interrupt execution of the htmlgend daemon.
     Note: Empty generation scripts should be renamed so wview does not execute them,
           which in rare cases can cause zombie processes.
</pre>


<br><br>
<a name="7. Weather Station Configuration"></a>
<hr size=2 noshade>
<h2>7. Weather Station Configuration</h2>
<pre>
This chapter contains station-specific configuration instructions. 
</pre>
<br>

<a name="7.1 Station Simulator"></a>
<hr size=2 noshade>
<h2>7.1 Station Simulator</h2>
<pre>
The Simulator station requires no physical weather station. It is a quick and 
easy way to demo wview. It also provides an excellent debug platform as cyclic 
data is generated. There is no station setup, just configure wview for the 
Simulator (--enable-station-sim) then choose Station Type *Simulator* when you run 
wviewconfig after build/install.
</pre><br>

<a name="7.2 Davis Vantage Pro/Pro2 Console"></a>
<hr size=2 noshade>
<h2>7.2 Davis Vantage Pro/Pro2 Console</h2>
7.2.1 Preparing a New Vantage Pro Console
<pre>
If you are installing a new VP console, there are a few initial settings 
that you need to set up so that your weather station and wview operate 
properly. Configuration of archive interval, station location (elevation, 
latitude and longitude) and your desired rain season start month must be
set up before you start wview for the first time. 
Below is a short description of each of these:

Archive Interval  - this determines how often the VP console will generate
                    an archive record and store it in its internal memory.
                    These records are retrieved by wview from the console
                    and stored in the archive files (and the archive database,
                    if database archiving is enabled). The valid values are:
                    5, 10, 15, 30, 60 (minutes). Keep in mind that the 
                    shorter the archive interval, the more records that will be 
                    generated. More records means a shorter time span for 
                    internal storage in the VP console memory and larger archive
                    files on the wview server disk (and larger database tables 
                    if stored in a database). I use an archive interval of 5 
                    minutes. TO AVOID HAVING TO DELETE ALL OF YOUR ARCHIVE DATA
                    LATER IN ORDER TO CHANGE THE ARCHIVE INTERVAL, IT IS VERY
                    IMPORTANT THAT YOU MAKE THIS CHOICE CAREFULLY AND NOT 
                    CHANGE IT AFTER ARCHIVE DATA HAS BEEN STORED BY WVIEW.
                    This does NOT effect how often HTML files containing 
                    current conditions are generated or the up to the minute
                    values they contain, this is controlled by the configuration
                    value "HTMLGEN_GENERATE_INTERVAL" in wview-conf.sdb. It will effect
                    the granularity of your charts for the last 24 hours.

Elevation         - this is given in feet above (or below) sea level. This is
                    the recommended way to calibrate your barometer.

Lat/Long          - this describes the location of your weather station.

Rain Season Start - this defines the first month of each year when yearly
                    rain totals will begin. Most people will use a value of
                    "1" here.

In order to set these parameters in the VP console, the "vpinstall" script is
provided with the wview distribution. Note that all of these can be configured 
using the On-Screen VP console setup utility. After building and installing wview, 
the vpinstall script can be found in ${exec-prefix}/bin (usually /usr/local/bin). It 
is an interactive script which queries you for these initial values then uses the
vpconfig utility to commit them to your new VP console. Once completed, it is
advisable to wait 10 minutes or so before starting wview for the first time as
it takes the VP console a little while to "digest" the new settings, in
particular for the barometer.
</pre>

<br>
7.2.2 Vantage Pro Plus Extended Sensor Support
<pre>
7.2.2.1 Overview

      Note: If you do not have a Vantage Pro Plus or Vantage Pro2 Plus and 
            you haven't added additional sensors ($$) to your VP, then there 
            is no reason to enable Plus extended data in wview-conf.sdb or to 
            enable extended sensor generation in images.conf. You will only be 
            wasting CPU cycles as the extended sensors will not be populated 
            with anything meaningful.

      The Vantage Pro Plus adds Solar Radiation, UV and Evapotranspiration (ET) 
      sensors with the potential to add other sensors. wview provides support 
      for historical charts (day, month and year) for the following VP Plus 
      sensors:

        Solar Radiation
        UV
        ET
        LeafTemp1
        LeafTemp2
        LeafWetness1
        LeafWetness2
        SoilTemp1
        SoilTemp2
        SoilTemp3
        SoilTemp4
        ExtraHumidity1
        ExtraHumidity2
        ExtraTemp1
        ExtraTemp2
        ExtraTemp3
        SoilMoisture1
        SoilMoisture2
        SoilMoisture3
        SoilMoisture4

      wview also can generate current condition buckets for Radiation, 
      UV and ET.

7.2.2.2 Configuration

--------  wview-conf.sdb

      --  Update $prefix/etc/wview/wview-conf.sdb (see configuration instructions)
      --  Modify the following parameter so it is enabled (yes):
          HTMLGEN_EXTENDED_DATA

--------  images.conf

      --  If this is a new install, skip to 12.2.2.2. To upgrade, you will need 
          to copy the new extended data image definitions from the distribution 
          example file images.conf found in .../wview-x.y.z/examples/conf. 
          The new definitions begin with the heading:
          "#################  V P  P L U S  D A T A  B U C K E T S  #################"
          Copy all definitions below this heading to your existing images.conf 
          file.
      --  Edit $prefix/etc/wview/images.conf
      --  Starting at the VP Plus Data Buckets header, enable all desired sensor
          images by removing all "#" characters from the beginning of the line.
          Remember, if you don't have the physical sensor installed on your 
          station, you should not enable the corresponding images for it - it 
          only wastes resources. At a minimum, it is safe to enable Radiation, 
          UV and ET images if you have a Plus station.
      --  For each new image you have enabled, translate or edit the title and 
          units strings as needed (no spaces in the units label).
      --  Save and Exit the editor

--------  html-templates.conf

      --  Edit $prefix/etc/wview/html-templates.conf
      --  Replace the corresponding old references with:
    
          almanac_Plus.htx
          Current_Plus.htx
          Daily_Plus.htx
          Monthly_Plus.htx
          Yearly_Plus.htx
        
          Leave index.htx unchanged.
      --  Save and Exit the editor

--------  index.htx

      --  Copy the Plus index.htx template over the standard file:
          cp $prefix/etc/wview/html/index_Plus.htx $prefix/etc/wview/html/index.htx
        
      --  Edit the index.htx file as usual to customize for your station,
          language and content preferences.

--------  Current_Plus.htx

      --  If upgrading, copy the example Current_Plus.htx file from
          the distribution to your wview config tree:
          cp wview-x.y.z/examples/html/Current_Plus.htx $prefix/etc/wview/html
      --  Edit $prefix/etc/wview/html/Current_Plus.htx as usual to customize 
          for your station, language and content preferences.
      --  Save and Exit the editor

--------  Daily_Plus.htx

      --  If upgrading, copy the example Daily_Plus.htx file from
          the distribution to your wview config tree:
          cp wview-x.y.z/examples/html/Daily_Plus.htx $prefix/etc/wview/html
      --  Edit $prefix/etc/wview/html/Daily_Plus.htx
      --  Delete all extended data image references that are NOT supported by
          your station. Find the comment lines:
          !-- ***** Extended Data Begin ***** --
          ...
            [extended sensor image references]
          ...
          !-- ***** Extended Data End ***** --
          and delete all non-supported sensor images. The extended sensor images
          remaining should match the "Day" images you enabled in images.conf.
      --  Edit $prefix/etc/wview/html/Daily_Plus.htx as usual to customize 
          for your station, language and content preferences.
      --  Save and Exit the editor

--------  Monthly_Plus.htx

      --  If upgrading, copy the example Monthly_Plus.htx file from
          the distribution to your wview config tree:
          cp wview-x.y.z/examples/html/Monthly_Plus.htx $prefix/etc/wview/html
      --  Edit $prefix/etc/wview/html/Monthly_Plus.htx
      --  Delete all extended data image references that are NOT supported by
          your station. Find the comment lines:
          !-- ***** Extended Data Begin ***** --
          ...
            [extended sensor image references]
          ...
          !-- ***** Extended Data End ***** --
          and delete all non-supported sensor images. The extended sensor images
          remaining should match the "Month" images you enabled in images.conf.
      --  Edit $prefix/etc/wview/html/Monthly_Plus.htx as usual to customize 
          for your station, language and content preferences.
      --  Save and Exit the editor

--------  Yearly_Plus.htx

      --  If upgrading, copy the example Yearly_Plus.htx file from
          the distribution to your wview config tree:
          cp wview-x.y.z/examples/html/Yearly_Plus.htx $prefix/etc/wview/html
      --  Edit $prefix/etc/wview/html/Yearly_Plus.htx
      --  Delete all extended data image references that are NOT supported by
          your station. Find the comment lines:
          !-- ***** Extended Data Begin ***** --
          ...
            [extended sensor image references]
          ...
          !-- ***** Extended Data End ***** --
          and delete all non-supported sensor images. The extended sensor images
          remaining should match the "Year" images you enabled in images.conf.
      --  Edit $prefix/etc/wview/html/Yearly_Plus.htx as usual to customize 
          for your station, language and content preferences.
      --  Save and Exit the editor
</pre><br>

c<a name="7.3 Vaisala WXT510"></a>
<hr size=2 noshade>
<h2>7.3 Vaisala WXT510</h2>
7.3.1 Overview
<pre>
The Vaisala WXT510 Weather Transmitter is a semi-professional instrument 
about the size of a 2 liter bottle of Coke. Ultrasonic wind speed sensors, 
non-tipping rain/hail measurement and low power are a few of the nice features 
of this station. A very simple NMEA 0183 protocol implementation is provided 
to retrieve the readings. Choose Station Type *WXT510* when you run wviewconfig.
</pre><br>
7.3.2 Preparing a WXT510 For wview
<pre>
When you built wview for the WXT510 (configure option --enable-station-wxt510)
the wxt510config utility was built and installed as well. It simply autobauds 
the WXT510 until it finds the station's current comm settings then resets the
station to 19200-8-N-1. wview startup will do the remaining initialization of 
the station.
To run it, determine what serial device your station is connected to, then as 
root execute:

    localhost> wxt510config [station_dev]

where [station_dev] is something like /dev/ttyS0, /dev/cuaa0, /dev/ttyUSB0, etc.

</pre>

<a name="7.4 La Crosse WS-2300 Series"></a>
<hr size=2 noshade>
<h2>7.4 La Crosse WS-2300 Series</h2>
7.4.1 Overview
<pre>
The La Crosse WS-2300 Series (WS-2300/2308/2310/2315) Personal Weather Station 
is a low-cost consumer grade station. Although it is proud to be wireless, it is
best implemented "cabled" between the sensors and the console. When cabled, it
will update the console with new data every 8 seconds. When ran wirelessly, it 
updates on the order of minutes, which is nearly useless for our purposes.
Choose Station Type *WS-2300* when you run wviewconfig.
</pre><br>
7.4.2 Preparing a WS-2300 Series For wview
<pre>
There is no preparation required - just connect to your serial port and go!
</pre><br>
7.4.3 Notes
<pre>
- The La Crosse weather stations do not provide Rain Rate calculation, so wview
provides it for you. It is a very simple implementation which looks at the last 
10 minutes of rainfall and scales it up to one hour.

- Choose Station Type *WS-2300* when you run wviewconfig.

</pre>

<a name="7.5 Oregon Scientific WMR918 Series"></a>
<hr size=2 noshade>
<h2>7.4 Oregon Scientific WMR918 Series</h2>
7.4.1 Overview
<pre>
The Oregon Scientific WMR918 Series (WMR918/968) Personal Weather Station 
is a low-cost consumer grade station.
Choose Station Type *WMR918* when you run wviewconfig.
</pre><br>
7.4.2 Oregon Scientific WMR918 Series For wview
<pre>
There is no preparation required - just connect to your serial port and go!
</pre><br>
7.4.3 Notes
<pre>
- The Oregon Scientific WMR918 weather stations do not provide Rain Rate calculation, 
so wview provides it for you. It is a very simple implementation which looks at the last 
10 minutes of rainfall and scales it up to one hour.

- The WMR9X8 stations send sensor packets (usually corresponding to a sensor suite)
  periodically. wview requires one packet from each sensor suite before it can complete
  initialization. Thus, if your outside temperature transmitter is down or malfunctioning,
  wview will not function properly.

- Choose Station Type *WMR918* when you run wviewconfig.

</pre>

<br><br>
<a name="8. Metric Units and Internationalization"></a>
<hr size=2 noshade>
<h2>8. Metric Units and Internationalization</h2>
<pre>
A configuration parameter in wview-conf.sdb named "HTMLGEN_METRIC_UNITS" has been 
added that if set to "yes" will cause wview to output all images (buckets and 
charts) as well as all values for HTML tags in the metric equivalents. 
The conversions are:

Temperature ........... Celsius
Barometer ............. Millibars
Wind Speed ............ Kilometers per hour
Rain .................. Centimeters

images.conf can be edited to translate the English labels, titles, and units to 
any language. By editing this file and the HTML template files, any language can 
be supported by wview. For existing installations, if the "HTMLGEN_METRIC_UNITS" 
parameter is not found in wview-conf.sdb, wview will assume US units and no 
conversions will be done. 
In fact one can easily switch back and forth between US and metric units by 
toggling this configuration value and restarting wview. 

NOTE:
All archive data in the SQLite3 database is still stored in US format - the 
conversions are only done for real time image and HTML file generation.

</pre>

<br><br>
<a name="9. Run Environment Description"></a>
<hr size=2 noshade>
<h2>9. Run Environment Description</h2>
<pre>
$prefix/etc/wview - configuration files

    *.conf                  - configuration files described below
    html/*.htx              - HTML template files to be customized for your 
                              site and language
    html/parameterlist.txt  - contains the list of all available HTML tags 
                              which can be placed in *.htx template files. 
                              These tags are replaced each time htmlgend 
                              generates new image and html files.

$prefix/var/wview - run time data files

    *.pid                   - run time pid files created/deleted by the wview
                              daemons. Do NOT alter or delete these files. They 
                              should only be present if the corresponding wview 
                              daemon is running.
    archive/wview-archive.sdb - SQLite 3 archive database file
    dev/*                   - FIFO device files created by wview - do NOT alter 
                              or delete them
    img/*                   - default destination for generated image and HTML
                              files - in particular if subsequent ftp/ssh of 
                              files is required
    noaa/noaa.dat           - NOAA data file
</pre>

<br><br>
<a name="10. Configuration Files Description"></a>
<hr size=2 noshade>
<h2>10. Configuration Files Description</h2>
<pre>
Note: Most wview configuration is now stored in an SQLite3 database at:
      $prefix/etc/wview/wview-conf.sdb. Thus SQLite3 must be installed and radlib
      must be configured with "--enable-sqlite".
Note: There are now several ways to configure wview through the SQLite3 database:
      wviewconfig (command line interface), Web Server ($HTTP_DOC_ROOT/wviewmgmt/login.php),
      Firefox (SQLite Manager Add-On) and SQLite Database Browser (QT-based GUI
      application).

1) wview-conf.sdb       - SQLite3 configuration database for wview.
                          Automatically updated by the wviewconfig script.

2) wview-conf.sql       - default SQLite3 wview configuration database backup
                          file. Can be used with the sqlite3 ".read" command to
                          recreate the default database.

3) images.conf          - defines which built-in images should be generated -
                          do NOT place user defined images in this file. This
                          file provides a list of the image files generated by
                          wview which can be used in HTML templates.
                          Requires manual editing by user.

4) images-user.conf     - defines user-defined images to be generated - note
                          that the corresponding image generator must be 
                          provided in the ".../htmlgenerator/images-user.c"
                          source file and listed in the "user_generators"
                          jump table at the bottom of the source file. The
                          index within the jump table should be referenced
                          from the "images-user.conf" file. These files can be
                          saved from the source tree when upgrading and copied
                          back to preserve user image definitions.
                          Requires manual editing by user.

5) html-templates.conf  - defines the html templates to be used for html
                          generation. User-defined templates may be listed
                          here so long as they utilize the tags as defined
                          in ".../examples/html/parameterlist.txt".
                          Requires manual editing by user.

6) forecast.conf        - defines the icon files and forecast text strings to 
                          be associated with the VP forecast icon and forecast 
                          rule values. Icon image file examples are found in 
                          wview-x.y.z/bin/img and can be copied to your weather 
                          web site. If you change the defaults in forecast.conf,
                          you will need to copy your new icon files to your 
                          weather web site.
                          See wview-x.y.z/examples/html/parameterlist.txt to 
                          find all available html tags including the forecast 
                          icon and rule tags. If absent (or renamed), no 
                          forecast icon or rule text will be stored or 
                          substituted for the corresponding html tags. This is 
                          the default and the way to disable the forecast 
                          storage and processing.
                          Requires manual editing by user.

7) arcrec-header.conf   - allows user configuration of the header written to 
                          each day's browser file. The default is English, but 
                          any language can be supported by changing the contents
                          of this file. Remember to keep column alignment in 
                          mind when changing this file. Total header size is 
                          limited to 1024 characters - this is the sum of all 
                          lines in arcrec-header.conf.
                          Requires manual editing by user.

8) graphics.conf        - Allows configuration of graphic colors and other 
                          properties.

Note: See the example config files for format descriptions.
</pre>

<br><br>
<a name="11. Using a MySQL or PostgreSQL Server to Store Data"></a>
<hr size=2 noshade>
<h2>11. Using a MySQL or PostgreSQL Server to Store Data</h2>
<pre>
    MySQL and PostgreSQL storage of weather data is now accomplished through export
    scripts which are provided in the wview distribution. These scripts are run via
    CRON periodically to export data from the SQLite3 databases to the export databases.

11.1  MySQL Installation and Setup

11.1.1  Ensure you have a functioning MySQL server running either local to the
        wview server or remote. In either case, you will need an account on the
        MySQL server which has create and grant privileges.

11.1.2  Prerequisites On the wview Server - be sure you have sqlite3 and mysqlimport
        installed on the wview server. Even if the MySQL server is remote, you need
        mysqlimport installed locally.

11.1.3  Local Server:

        Create the MySQL Database, tables and user:
        (Be sure you have set your MySQL account settings using wviewmgmt or wviewconfig
        before creating locally).
        > wview-mysql-export create <root_mysql_user_password>
          (This runs wview-mysql-create for you locally using wview-conf.sdb settings)

11.1.4  Remote Server:

        Copy the wview-mysql-create script to the remote server:
        > scp $exec_prefix/wview-mysql-create <username>@<mysql_host>:/downloads
          (copy wherever you like on the remote server)
          (wview-mysql-create can be found by executing: whereis wview-mysql-create)

        Login to the remote server:
        > ssh <username>@<mysql_host>

        Execute the create script (make sure the admin user has the right privileges):
        > wview-mysql-create help  (to see usage text)
        > wview-mysql-create <admin_username> <admin_password> <db_username> <db_password> <db_name>
          (admin_username can be the same as db_username)

        Log out of the remote server:
        > exit

11.2   PostgreSQL Installation and Setup

       NOTE: The PostgreSQL user created when you setup PostgreSQL will 
             either be pgsql or postgres. postgres is used for this example. We
             will use the unix root account for all export activities so the
             create and export scripts should be run as root or from the root
             CRON table.

11.2.1  Ensure you have a functioning PostgreSQL server running either local to the
        wview server or remote.

11.2.2  Prerequisites On the wview Server - be sure you have psql installed on 
        the wview server. Even if the PostgreSQL server is remote, you need psql 
        installed locally.

11.2.3  Create a PostgreSQL user for the unix root user:

          Login to the PostgreSQL account:
          user@wview_server> su
          root@wview_server:# su postgres
          
          Create an administrative user based on the root unix account:
          postgres@wview_server:# createuser root
          
          Answer the question:
          Shall the new role be a superuser? (y/n) y
          
          Logout of the PostgreSQL account:
          postgres@wview_server:# exit
          root@wview_server:#

11.2.4  Create the wview database:

          Create the wview database:
          root@wview_server:# createdb wviewDB

          Note: wviewDB should be the same value specified in wview-conf.sdb for 
          STATION_SQLDB_DB_NAME.

11.2.5  Create the export tables and 'replace' triggers:

          root@wview_server:# wview-pgsql-create wviewDB
          

11.3  Test Run and Debug

      The end game is to create a cron job which runs wview-mysql-export periodically
      (every 5 minutes seems reasonable although the export is surprisingly fast so
      1 minute periods are not out of the question). First, let's run it from the
      command line and confirm it is working.
      Note: If using PostgreSQL, substitute "wview-pgsql-export" for "wview-mysql-export".

11.3.1  Execute with debugs enabled:
        > wview-mysql-export debug

11.3.2  Examine the CSV export files:
        > cat $prefix/etc/wview/export/archive.csv
        > cat $prefix/etc/wview/export/outTemp.csv
        > cat $prefix/etc/wview/export/noaaHistory.csv

        These will probably be large given this was the first export. They should
        contain all records up to the present time.

11.3.3  Examine the MySQL tables:
        (login to the remote server if not local)
        > mysql --user=<db_username> --password=<db_password>
        mysql> use <db_name>;
        mysql> select count(*) from archive;
        (This should match the record count in your SQLite3 database)
        mysql> select * from windDir;
        (The 20 wind direction bins should display direction counts = 60/archive_interval
        for each row)
        mysql> select * from noaaHistory;
        (There should be one record for each day of archive data)

11.3.4  Examine the Import Logs:
        > cat $prefix/etc/wview/export/mysql_import.log

11.4  Production Setup

11.4.1  Add to the root crontab on the wview server:
        > sudo crontab -e
        Add the following line and save the crontab:
        1,6,11,16,21,26,31,36,41,46,51,56 * * * * $exec_prefix/wview-mysql-export
        This runs the wview-mysql-export script every 5 minutes (1 minute past 
        archive record reception for 5 minute archive interval)

        Example where $exec_prefix is "/usr/local/bin":
        1,6,11,16,21,26,31,36,41,46,51,56 * * * * /usr/local/bin/wview-mysql-export

        Note: You must include a full path for the wview-mysql-export script in the
              cron table.

11.4.2  Done - you can check the $prefix/etc/wview/export directory and the MySQL
        database to confirm the updates.

11.5  Notes

      The records imported into the MySQL database tables are set to replace any
      existing records with the same dateTime stamp. This is so we get the latest
      HILOW records for the current hour and so if better/more complete data is
      re-exported, it will take precedence over older data. You will notice in the
      debug log file $prefix/etc/wview/export/mysql_import.log that records are 
      deleted and inserted at incremental updates. This is the HILOW last record
      phenomenon.

      If you need to cause a complete re-export of all data, delete the file
      $prefix/etc/wview/export/mysql_export_marker. The next time the wview-mysql-export
      script runs, all data will be exported (and replace existing data in the MySQL 
      database).

11.6  PostGreSQL and FreeBSD Semaphore Resources

      FreeBSD starts with a limited number of semaphores available for application 
      use. radlib/wview use some semaphores and so does PostgreSQL. Often the
      default number is not sufficient. Here is how to increase the number of
      semaphores available:

      1) In /boot/loader.conf add the lines:
          kern.ipc.semmni="256"
          kern.ipc.semmns="512"
          kern.ipc.semmnu="256"

      2) In /etc/sysctl.conf add these lines:
          kern.ipc.shmmax=536870912
          kern.ipc.semmap=256
          kern.ipc.shm_use_phys=1
          kern.ipc.shmall=131072 

      3) Reboot

</pre>


<br><br>
<a name="12. Setting Up FTP Transfers"></a>
<hr size=2 noshade>
<h2>12. Setting Up FTP Transfers</h2>
<pre>
12.1  tnftp

   wview's ftp daemon requires the tnftp utility which is standard for all BSD
   distributions and some linux distributions such as SuSE. Others, such as 
   Fedora Core and Debian, have the vanilla FTP client which is almost useless.
   In this case you are going to have to replace the old FTP client with tnftp.
   
   To determine if you have tnftp installed, execute the following:

    localhost:~> /usr/bin/ftp
    ftp> status
    Not connected.
    No proxy connection.
    Gate ftp: off, server (none), port ftpgate.
    Passive mode: on; fallback to active mode: on.
    Mode: ; Type: ; Form: ; Structure: .
    Verbose: on; Bell: off; Prompting: on; Globbing: on.
    Store unique: off; Receive unique: off.
    Preserve modification times: on.
    Case: off; CR stripping: on.
    Ntrans: off.
    Nmap: off.
    Hash mark printing: off; Mark count: 1024; Progress bar: on.
    Get transfer rate throttle: off; maximum: 0; increment 1024.
    Put transfer rate throttle: off; maximum: 0; increment 1024.
    Socket buffer sizes: send 32768, receive 65536.
    Use of PORT cmds: on.
    Use of EPSV/EPRT cmds for IPv4: on.
    Command line editing: on.
    Version: NetBSD-ftp 20040410  -OR-
    Version: tnftp                -OR-
    Version: lukemftp
    ftp> quit
    
    The key in this output is the Version line: NetBSD-ftp or tnftp or lukemftp is 
    what we are looking for. If you don't get similar output, you need to install tnftp.

   To install tnftp, do the following:
   
   Debian/Ubuntu/Kubuntu:
   > sudo apt-get install tnftp
   And use /usr/bin/tnftp as your FTP binary.

   Source Install:
   Download from here: ftp://ftp.netbsd.org/pub/NetBSD/misc/lukemftp/tnftp-20050625.tar.gz

   Extract it: tar zxvf tnftp-20050625.tar.gz
    
   cd to the directory: cd tnftp-20050625
    
   Then execute the following as root (you can cut and paste these commands):
    ./configure
    make
    make install
    mv /usr/bin/ftp /usr/bin/ftp-old
    ln -s /usr/local/bin/ftp /usr/bin/ftp
    
    If /usr/kerberos/bin/ftp exists:
    
    mv /usr/kerberos/bin/ftp /usr/kerberos/bin/ftp-old
    ln -s /usr/local/bin/ftp /usr/kerberos/bin/ftp

12.2  Remote Server Directory Setup

   wviewftpd will place all files it transfers into the [conf_directory]
   directory under your ftp login directory on the remote server.
   [conf_directory] is the value of the "directory" configuration value in
   wview-conf.sdb.

      localhost:~> telnet [remote_host]
      username: [remote_username]
      password: [remote_password]
      [remote_host]:~> mkdir -p [conf_directory]
      [remote_host]:~> mkdir -p [conf_directory]/NOAA
      [remote_host]:~> mkdir -p [conf_directory]/Archive
      [remote_host]:~> logout

12.3  Move Static Files to Server

   Certain files like background images and other support files are not 
   transferred by wviewftpd to conserve bandwidth, so you should place them on 
   the remote server manually before running wview with FTP enabled but after 
   having executed "make install" for new installs. The following command 
   is also of the same format as what wview uses, thus testing your ftp setup.
   Replace remote_username, remote_password and remote_host with the proper 
   values for your remote ftp host account. Do not add or remove spaces in this
   command!

      cd $prefix/var/wview/img
      /usr/bin/ftp -iV -u ftp://remote_username:remote_password@remote_host/[conf_directory] *.*

12.4  Configure wviewftpd

   Edit $prefix/etc/wview/wview-conf.sdb as described earlier.

12.5  Start wview
      [your_distro_start_script_location]/wview start

12.6  Debug

   If you are having any problems and wish to get more feedback concerning the tnftp 
   command line or stderr output, see the file wviewftp.debug.sh in the distro ftp
   directory.  It contains instructions for how to gain access to the tnftp command line
   being executed and the stderr output from it.
</pre>


<br><br>
<a name="13. Alarms and wview As a Data Feed Engine"></a>
<hr size=2 noshade>
<h2>13. Alarms and wview As a Data Feed Engine</h2>
<pre>
13.1  Overview
   To implement wview alarm capability, a new daemon process has been added: 
   wvalarmd. Like the wviewftpd daemon, if the configuration database wview-conf.sdb
   has the "ENABLE_ALARMS" paremeter enabled when wvalarmd starts, it will exit and alarms 
   will be disabled. wvalarmd "registers" with the wviewd daemon to receive 
   LOOP data at an interval determined by the "STATION_PUSH_INTERVAL" configuration
   value for wviewd in wview-conf.sdb (the default is every 60 seconds). When 
   a new LOOP data packet is received by wvalarmd, it checks all defined alarms
   to determine if an alarm has been triggered. If so, the alarm abatement 
   counter is initialized and the alarm binary/script is invoked with the 
   following arguments:

       argv[0]/$0         full path of binary/script being run
       argv[1]/$1         alarm type (see definitions below)
       argv[2]/$2         alarm threshold
       argv[3]/$3         value which triggered the alarm
       
   It is not hard to conclude the following:
   
       1) Multiple alarm scripts may be defined for the same LOOP data value.
       2) Multiple LOOP data values may use the same binary/script since the 
          alarm type, threshold and triggering value are all passed to the
          binary/script.
       3) wview alarms could be used as a data feed to another application
          which requires weather data updates, you could even run an 
          "html-less" wview that does nothing more than archive weather data
          and feed current values to another application via wvalarmd.
          
13.1.1  Alarm Abatement - to control the frequency for which an alarm 
        script/binary is invoked while the data type is exceeding the threshold,
        an alarm configuration parameter called Abatement is provided. This is 
        simply the number of seconds after an alarm triggers to "hold off" or 
        not invoke the alarm binary/script. Once this abatement period expires,
        a new alarm binary/script invocation will occur if the alarm is 
        triggered.

13.1.2  Alarm Update Frequency - this is controlled by the "STATION_PUSH_INTERVAL"
        parameter in wview-conf.sdb. It is given in milliseconds. One should 
        avoid setting it to anything less than 10000 (10 seconds) - I'm 
        sure it would be fine, but you are not going to get new data updates
        from the VP Console any faster than once every 10 seconds, because
        that is controlled by the parameter described in the next section.

13.1.3  Weather Data Update Frequency - this is controlled by the 
        "STATION_ARCHIVE_INTERVAL" parameter in wview-conf.sdb. This determines how often
        the wviewd daemon polls the VP Console for current conditions. It is 
        given in milliseconds and should not reasonably be set to anything 
        less than 10000 (10 seconds), and must be an even divisor of 60000.

13.1.4  Raw Data Feeds - wvalarmd implements a TCP socket server to accept 
        connections for clients wanting a raw feed of loop packet data. See 
        the section "Socket-Based Data Feeds" below for details.

13.2  Configuration

13.2.1  $prefix/etc/wview/wview-conf.sdb

13.2.1.1  Edit $prefix/etc/wview/wview-conf.sdb
13.2.1.2  Configure the PUSH_INTERVAL parameter to your requirements. This
          value is given in seconds, so 60 seconds would be specified
          by a value of 60. This determines how often wvalarmd will receive
          current conditions data.
13.2.1.3  Save and Exit the editor

13.2.2  $prefix/etc/wview/wview-conf.sdb

13.2.2.1  Edit $prefix/etc/wview/wview-conf.sdb
13.2.2.2  Choose your station units type by indicating "STATION_US" or
          "STATION_METRIC" in wview-conf.sdb.
13.2.2.3  List your alarm definitions for up to 10 distinct alarm definitions.
13.2.2.4  Save and Exit the editor

13.2.3  Scripts: $prefix/etc/wview/alarms/*.sh

13.2.3.1  If using notification scripts, they should be placed in 
          $prefix/etc/wview/alarms and will receive the arguments described above
          when invoked.
13.2.3.2  There are a few example scripts in the distribution directory
          .../wview-x.y.z/examples/alarms - these will be copied to 
          $prefix/etc/wview/alarms for new installs which build with the "install"
          target or can be copied there when upgrading an existing installation.
13.2.3.3  If using custom binaries, make note of the arguments passed to the
          binary above.
13.2.3.4  The example scripts log alarm events to a log file: 
          $prefix/var/wview/alarms/alarm.log. This may be a feature you want to keep -
          even if you are doing other things in your alarm notification 
          scripts.

13.3  Alarm Type Definitions

   Type (wview-conf.sdb)     Value (passed to script/binary)
   ----------------------    -------------------------------
   Barometer                 0
   InsideTemp                1
   InsideHumidity            2
   OutsideTemp               3
   WindSpeed                 4
   TenMinuteAvgWindSpeed     5
   WindDirection             6
   OutsideHumidity           7
   RainRate                  8
   StormRain                 9
   DayRain                   10
   MonthRain                 11
   YearRain                  12
   TxBatteryStatus           13
   ConsoleBatteryVoltage     14
   DewPoint                  15
   WindChill                 16
   HeatIndex                 17
   Radiation                 18
   UV                        19
   ET                        20
   ExtraTemp1                21
   ExtraTemp2                22
   ExtraTemp3                23
   SoilTemp1                 24
   SoilTemp2                 25
   SoilTemp3                 26
   SoilTemp4                 27
   LeafTemp1                 28
   LeafTemp2                 29
   ExtraHumid1               30
   ExtraHumid2               31


13.4  Getting a "Warm Fuzzy"

   To get an idea how it works and to gain familiarity with configuration, do
   the following:
   
13.4.1  Stop wview as you normally would:
            [FreeBSD]   /etc/rc.d/wview stop            -OR-
            [SuSE]      /etc/init.d/wview stop          -OR-
            [RH/Fedora] /etc/rc.d/init.d/wview stop

13.4.2  Enable Alarms - update wview-conf.sdb to enable alarms

13.4.3  Configure the Update Interval - update wview-conf.sdb and set the
        update (PUSH) interval to 60 seconds

13.4.4  Get Example Alarm Scripts
        New Installs: 
            make install
        
        Upgrades: 
            mkdir $prefix/etc/wview/alarms
            mkdir $prefix/var/wview/alarms
            cp wview-x.y.z/examples/alarms/* $prefix/etc/wview/alarms
            
13.4.5  Edit the Thresholds - update wview-conf.sdb for thresholds very near 
        (or already "past") your current outside temperature

13.4.6  Start wview as you normally would:
        [FreeBSD]   /etc/rc.d/wview start           -OR-
        [SuSE]      /etc/init.d/wview start         -OR-
        [RH/Fedora] /etc/rc.d/init.d/wview start

13.4.7  Watch the magic:
            tail -f $prefix/var/wview/alarms/alarm.log

13.5  Socket-Based Data Feeds

13.5.1  Overview
      For true data feeds, wvalarmd provides a socket server which listens on 
      port 11011 of the wview server for connections. When a datafeed client 
      connects on that port, wvalarmd adds the client to the datafeed client 
      list. Then when loop data is received from wviewd, wvalarmd will write 
      the loop packet into each datafeed client's socket, preceded by a start 
      frame sequence. It is a one-way interface and the client may disconnect 
      at any time by calling "shutdown" followed by "close" to close the 
      socket. The number of active client connections is only limited by system 
      resources. The datafeed client will receive the full loop packet as 
      defined in common/datadefs.h - see the structure "LOOP_PKT".

13.5.2  Configuration
      None required for socket data feeds, just the normal PUSH_INTERVAL setup 
      described above. No alarm entries are required in wview-conf.sdb for 
      datafeed clients.

13.5.2  Client Requirements
      The datafeed sockets are regular TCP/stream PF_INET sockets. The general 
      connection steps (in C) are as follows:
        
        socket (...)        // create the socket descriptor
        [setup server address and port in socckaddr_in structure]
        connect (...)
        
      The client then may add the socket descriptor to an fdset for select 
      calls, simply block on the socket for reads, however you want to design 
      it. Other programming language procedures may differ, but the general 
      approach should be the same.
      
      Normal Processing "Loop":
      
      1) Wait for data on the socket
      2) Sync to the start frame sequence: 0xF388, 0xC6A2, 0xDADA, 0xE7CF
      3) Read loop packet
      4) Process loop packet
      5) Goto #1
      
      To disconnect:
      
        shutdown (sockfd, 2)
        close (sockfd)
      
      Note: There is a handy new radlib socket API which is illustrated in the 
            sample datafeed client source code which takes care of most of the 
            above procedure for you.

13.5.3  Running the Example Datafeed Client
      The directory alarms/sample-datafeed-client contains a simple client 
      example including Makefile. It accepts an argument for host but will 
      use "localhost" if none is given. It connects to the wvalarmd server 
      and logs the current temperature when loop packets are received.

13.5.3.1  Build the example client:
        (radlib-2.1.0 or higher is required)
        cd alarms/sample-datafeed-client
        make (or "gmake" for *BSD)

13.5.3.2  Run it:
        (with wview already running)
        ./datafeedClient [wview_hostname]

13.5.3.3  Watch the system log for wvalarmd connection messages and update 
          messages from the example client:
        tail -f /var/log/messages

13.5.3.4  Kill the example client:
        Either "ctrl-c" if you ran it in the foreground, or "kill -15 [pid]" 
        if you backgrounded it when you started it.

13.5.3.5  Testing multiple clients:
        Just repeatedly run the datafeed client application - each client 
        will have its own socket connection to wview. Kill them as described 
        above when you are done.
</pre>

<br><br>
<a name="14. Secure File Transfer (rsync/ssh)"></a>
<hr size=2 noshade>
<h2>14. Secure File Transfer (rsync/ssh)</h2>
<pre>
14.1  Overview
   A new wview daemon has been added to support secure file transfers to 
   remote servers: wviewsshd. It is enabled or disabled in the same way that
   the wviewftpd and wvalarmd daemons are - by editing the SQLite3 database file
   $prefix/etc/wview/wview-conf.sdb. All three of these utility daemons are disabled
   in the standard distribution. The secure updates are performed using rsync over 
   an ssh session. To work properly, the wview server must be able to login and/or 
   execute commands on the destination server via ssh WITHOUT entering a password. 
   This is accomplished by copying the wview server's root account shared ssh key 
   to the remote server's login account.
   
   Suggestion: Don't mix hostname with IP address for the remote server during
               the configuration below. Decide NOW whether you are going to use
               a hostname or an IP address, and use it consistently for all
               references to [remote_host] below. ssh does make a distinction
               when storing and verifying shared keys.

   Placeholders:
   
   [remote_host]             - the host we want to update
   [ssh_login_user]          - the user account name on the [remote_host] we
                               want to use for the ssh logins
   [remote_test_dir]         - remote directory to receive files, relative
                               to the [ssh_login_user] login home directory
                               *[ssh_login_user] must have write access to this 
                               directory*
   [wview_server]            - the wview host
   
   Note: I have included prompts of the form "username@host:# " to help
         clarify what is being executed on what host. Your actual shell
         prompts may be different, this is only for clarity in this procedure.

   Note: This procedure assumes compatible versions of ssh - version 1 and 
         version 2 of openssh have compatability problems as well as with 
         ssh.com versions 1 and 2. If you are having problems with the setup,
         I strongly suggest going to the following URL for advanced help:
         http://gentoo-wiki.com/SECURITY_SSH_without_a_password.

14.2  Prerequisites

14.2.1  Verify rsync is installed on the wview server:
        
        root@[wview_server]:# whereis rsync
        
        If that doesn't produce /usr/bin/rsync or similar, install rsync.

14.2.2  Verify rsync is installed on the remote host:

        root@[wview_server]:# ssh -l [ssh_login_user] [remote_host]
        [enter password]
        [ssh_login_user]@[remote_host]:# whereis rsync
        
        If that doesn't produce /usr/bin/rsync or similar, install rsync.
        
        Logout:
        
        [ssh_login_user]@[remote_host]:# exit 

14.3  ssh Shared Key Setup

14.3.1  Generate a public/private key pair for the root user on the wview
        server (if it does not already exist) (execute as the root user):
        
        root@[wview_server]:# mkdir -p ~/.ssh
        root@[wview_server]:# ssh-keygen -t rsa
        
        Just hit enter for default values when asked questions.
        This will create two files, we are interested in the ~/.ssh/id_rsa.pub
        file.

14.3.2  Transfer id_rsa.pub to [remote_host]. Use ftp, scp, email, floppy 
        disk, whatever you want to get this file to the remote host.

14.3.3  Login to [remote_host] as [ssh_login_user] and append the contents of 
        id_rsa.pub into ~/.ssh/authorized_keys (if authorized_keys does not 
        exist, just rename id_rsa.pub to authorized_keys).
        
        root@[wview_server]:# ssh -l [ssh_login_user] [remote_host]
        [enter password]
        [ssh_login_user]@[remote_host]:# mkdir -p ~/.ssh
        [ssh_login_user]@[remote_host]:# cd ~/.ssh
        [ssh_login_user]@[remote_host]:# cat id_rsa.pub >> authorized_keys
        [ssh_login_user]@[remote_host]:# chmod 600 authorized_keys
        
        Stay logged in - we need it for the next step.

14.3.4  As root on the wview server, ssh into [remote_host] as [ssh_login_user],
        answer "yes" if this is the first time, then logout. This sets the 
        [remote_host] up in the wview server root account's "known_hosts" file.
        
        root@[wview_server]:# ssh -l [ssh_login_user] [remote_host]
        [no password should be required!]
        [ssh_login_user]@[remote_host]:# exit

14.3.5  Finally, we need to set up ssh for the root user so that when 
        [remote_host] is logged into, ssh uses [ssh_login_user] instead of
        root for the login on [remote_host]. This must be done for every 
        [remote_host] entry in wview-conf.sdb. This is what specifies which 
        user account is used for the ssh login to each [remote_host].
        
        Edit /root/.ssh/config and put the following at the top of the file
        (just create a new file if it does not exist):
        
        [text start]
        Host [remote_host]
        User [ssh_login_user]
        [text end]
        
        Save and exit that file.

14.3.6  Mandatory Tests - these must succeed before going any further:

        As root on the wview server execute:
        root@[wview_server]:# ssh [remote_host]

        You should be logged in to [remote_host] as [ssh_login_user] without 
        entering a password.
        
        Exit the remote host shell:
        [ssh_login_user]@[remote_host]:# exit

        You should now be able to remotely execute commands over ssh. Verify 
        this by executing the date command from the wview server as root: 
        
        root@[wview_server]:# ssh [remote_host] date

        This MUST execute without requiring a password. If it does not, go back
        to the beginning of shared key setup and double check your steps.
        
        DO NOT proceed if you cannot login/execute commands remotely as
        [ssh_login_user] without a password. This is critical! There is much 
        online documentation concerning ssh setup, this is only a bare-bones
        treatment of the subject.

14.4  Confirming rsync Functionality

14.4.1  Place files in $prefix/var/wview/img (if it is not already your "HTMLGEN_IMAGE_PATH"
        in wview-conf.sdb):
        
        root@[wview_server]:# cp [some_test_files] $prefix/var/wview/img

14.4.2  Create/Verify the destination path on the remote server 
        (as [ssh_login_user]):
        
        root@[wview_server]:# ssh [remote_host]
        
        [you are now logged in as [ssh_login_user] without a password, right?]
        
        [ssh_login_user]@[remote_host]:# cd ~  
        
        [this is your ssh login directory - all wview-conf.sdb destination
        paths are relative to this directory]
        
        [ssh_login_user]@[remote_host]:# mkdir -p [remote_test_dir]
        
        Note: [remote_test_dir] is a relative path from the [ssh_login_user] 
              login directory - it CANNOT contain a leading "slash".

        Logout:

        [ssh_login_user]@[remote_host]:# exit
        
14.4.3  Test rsync over ssh from the wview server:
        root@[wview_server]:# rsync -aqz --rsh=ssh $prefix/var/wview/img/ [remote_host]:[remote_test_dir]

        This should transfer the files you placed in $prefix/var/wview/img to the 
        remote server in the [remote_test_dir] directory without a password
        being required.
        
        *****!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT !!!!!!!!!!!!!!!!!!!!!!!!!*****
        wview ssh file transfer capability will NOT work until you can
        successfully execute this command from the wview server and verify 
        the file transfers on the remote server.
        *****!!!!!!!!!!!!!!!!!!!!!!!!! IMPORTANT !!!!!!!!!!!!!!!!!!!!!!!!!*****

14.5  Configuring wview For Secure Transfers

14.5.1  Stop wview as you normally would:
            [FreeBSD]   /etc/rc.d/wview stop            -OR-

            [SuSE]      /etc/init.d/wview stop          -OR-
            [RH/Fedora] /etc/rc.d/init.d/wview stop

14.5.2  Update $prefix/etc/wview/wview-conf.sdb adding up to 5 rsync rules.

        Each [remote_host] entry must have a corresponding "Host" entry in
        /root/.ssh/config which specifies the login account ([ssh_login_user]) 
        to use for ssh. See section 14.3 above. Further, the procedures outlined 
        in sections 14.2-14.4 MUST be followed for each unique [remote_host] 
        [ssh_login_user] combination.

14.5.5  Start wview as you normally would:
            [FreeBSD]   /etc/rc.d/wview start           -OR-
            [SuSE]      /etc/init.d/wview start         -OR-
            [RH/Fedora] /etc/rc.d/init.d/wview start
</pre>

<br><br>
<a name="15. Miscellaneous"></a>
<hr size=2 noshade>
<h2>15. Miscellaneous</h2>
<pre>
15.1  Observing wview Operation

   wview logs quite a bit of information about what is being initialized, 
   daemons started, etc. in the system log file (/var/log/messages, /var/log/syslog,
   etc.). This is where to go to try to investigate a startup problem or just observe
   what wview is "doing".
   On the other hand, once you get everything set up the way you want, you 
   can disable informational logs if you are concerned about how quickly your 
   /var/log/messages file is rolling over (you are rotating your log files, 
   right?). Set STATION_VERBOSE_MSGS=0 in $prefix/etc/wview/wview-conf.sdb to disable 
   informational log entries. You can always re-enable it if you need the 
   verbosity.

15.2  Notes On Console Poll Timer Settings

   The STATION_POLL_INTERVAL setting in wview-conf.sdb MUST be less than or equal 
   to 60000 (60 seconds), and it must be an even divisor of 60000.

   If the value found in wview-conf.sdb does not meet these criteria, wviewd
   will default to 30 seconds.

15.3  Notes On Generation Timer Settings

   The wview-conf.sdb variables HTMLGEN_START_OFFSET and HTMLGEN_GENERATE_INTERVAL control when
   and how often the image and HTML generation occurs. Some examples:

START_OFFSET[1]=0
GENERATE_INTERVAL[1]=1
   Start at 0 minutes past the next 5 minute mark (0, 5, 10, ...) and then
   generate every 1 minutes - Once it starts, it will generate ~10 seconds 
   past every minute of each hour

START_OFFSET[1]=2
GENERATE_INTERVAL[1]=5
   Start at 2 minutes past the next 5 minute mark (0, 5, 10, ...) and then
   generate every 5 minutes - Once it starts, it will generate ~10 seconds 
   past the 5 minute plus 2 mark (2, 7, 12, 17, 22, ...) of each hour

START_OFFSET[1]=3
GENERATE_INTERVAL[1]=10
   Start at 3 minutes past the next 5 minute mark (0, 5, 10, ...) and then
   generate every 10 minutes - Once it starts, it will generate ~10 seconds 
   past one of the following: (3, 13, 23, ...) or (8, 18, 28, ...) minutes of 
   each hour

Note: Archive records are received within the first minute of the 
      archive interval position in the hour.
          For 5 minute archive interval: 0, 5, 10, 15, 20, ...
          For 30 minute archive interval: 0, 30
      Thus in order to insure you get the newest archive data in the 
      generation, unless you are using a 1 minute GENERATE_INTERVAL, you 
      should use an offset of 1 or greater.

15.4  Notes on Image Generation

   The daily historical charts are generated using the archive records from 
   the last 24 hours. The granularity depends upon your archive interval 
   choice. These charts are updated at the same frequency as the archive 
   interval to include the last archive interval.

   The 28-day historical charts are generated using the hourly average of 
   archive records for the last 28 days. These charts are updated once per
   hour to include the last hour's averages.

   The 365-day historical charts are generated using the daily average of
   archive records for the last 365 days. These charts are updated once per 
   day (12:01AM) to include the last day's averages.


15.5  Tweaking Your Barometric Pressure

      Sometimes it is necessary to calibrate your VP console barometer. To do 
      this we use the vpconfig utility.

15.5.1  Stop wview.
        /etc/rc.d/init.d/wview stop (or where your wview start script is located)

15.5.2  Change your elevation.
        /usr/local/bin/vpconfig /dev/ttyS0 setelevation [new value in feet]
        (this assumes a prefix of /usr/local and serial device being /dev/ttyS0)

15.5.3  Restart wview.
        /etc/rc.d/init.d/wview start

      Note: the VP console takes a few minutes to "digest" the new elevation 
            and barometric pressure values my be skewed until it normalizes.

15.6  vpconfig Usage

      Note 1: It is not advisable to use vpconfig to change the archive 
              interval or rain season start after the initial configuration 
              (using vpinstall). This will skew your rain season totals or 
              render your archived data unusable. If you do change the archive 
              interval after records have been stored by wview, you will need 
              to delete all archive data in $prefix/var/wview/archive/wview-archive.sdb
              before restarting wview.
      
      Note 2: You MUST stop wview before using vpconfig to view or change 
              settings!

      Usage: vpconfig [station_dev] [command] [cmnd_args]

      station_dev  serial device the VP console is connected to:
                    FreeBSD: /dev/cuaa0 - /dev/cuaa4
                    Linux:   /dev/ttyS0 - /dev/ttyS4

      command      command to execute, one of:
                     show
                       - retrieve and display VP console config
                     cleararchive
                       - clear the archive memory without changing the interval
                     setinterval [interval in minutes]
                       - set the archive interval (this clears the archive memory)
                     setelevation [elevation in feet]
                       - set the station elevation (feet) - use this to adjust barometer
                     setgain [0 for off, 1 for on]
                       - sets the gain of the radio receiver
                     setlatlong [latitude (negative for S)] [longitude (negative for W)]
                       - set the station latitude and longitude in tenths of a degree
                     setrainseasonstart [month (1-12)]
                       - set the month that the yearly rain total begins

15.7  Ethernet Setup for the GW21E Serial Server

15.7.1  Configure your GW21E IP address as described in the GW21E Quickstart 
        Guide.

15.7.2  Telnet into the GW21E (admin,NULL)

15.7.3  Set Serial Server parameters and Packet Delimiter so that your config
        looks like:

        [snip]
        root@localhost:/root/dev# telnet 10.10.10.22
        Trying 10.10.10.22...
        Connected to 10.10.10.22.
        Escape character is '^]'.
        ABLELink Ethernet-Serial Server
        User name:admin
        Password:
        
        Login ok
        
        0.Exit  1.Overview  2.Networking  3.Security  4.COM1
        
        Input choice and enter(0~4): 4
        4
        
        COM0:
        1.  Link Mode (TCP Server/Virtual COM Disabled/Pair Connection Disabled/Filter disabled/3001 /Alive=10*10 sec)
        2.  COM Port (VP/RS-232/19200,None,8,1/RTS/CTS)
        3.  Keep Serial Buffer's Data While Connecting(Disabled)
        4.  Packet Delimiter (1 ms)
        5.  Accept Control Command from COM port (Disabled)
        
        Input choice and enter(1~5):
        [snip]

        Remember to use "CTRL-]" to get to the telnet prompt and type "quit" to
        exit - their utility does not have an exit path in the menu! I had to 
        quit and re-login multiple times while configuring it.
        
        Given the above configuration, your wview ethernet configuration should
        be:
        Host: 10.10.10.22    (whatever the IP address is that you assigned it)
        Port: 3001           (set in section 4 of the GW21E config utility)

15.8  Ethernet Setup for the Lantronix MSS1-T

15.8.1  Connect to the MSS1-T via the serial port - factory defaults are
        9600, 8N1. Login as admin, then enter "set privileged" with password 
        "system".

15.8.2  Configure the MSS1-T so that your "show server" command displays:

        Lantronix MSS1 Version V3.5/5(980529)
        
        Type HELP at the 'Local_2> ' prompt for assistance.
        
        Username> admin
        
        Local_2> show server
        
           MSS1 Version V3.5/5(980529)            Uptime:                  0:06:16
           Hardware Addr: 00-80-a3-0f-f3-e2       Name/Nodenum:      MSS_0FF3E2/ 0
           Ident String: Micro Serial Server
        
           Inactive Timer (min):           30     Serial Delay (msec):          10
           Password Limit:                  3     Session Limit:                 4
           Queue Limit:                    32     Node/Host Limits:          50/20
        
        LAT  Circuit Timer (msec):         80     Keepalive Timer (sec):        20
           Multicast Timer (sec):          30     Retrans Limit:                10
        
        TCP/IP Address:           10.10.10.22     Subnet Mask:       255.255.255.0
           Nameserver:            (undefined)     Backup Nameserver:   (undefined)
           TCP/IP Gateway:         10.10.10.1     Backup Gateway:      (undefined)
           Domain Name:           (undefined)     Daytime Queries:         Enabled
                                                  TCP Keepalives:          Enabled
           DHCP Server:                  None     Lease Time:                 0:00
        
           Load Address:    00-00-00-00-00-00     Prompt:              Local_%n%P>
        
           Characteristics:
           Incoming Logins:  Telnet   (No Passwords Required)
           LAT Groups: 0
        
        Local_2>

        The port to use on the MSS1-T is the raw mode port 3001.
        
        Given the above configuration, your wview ethernet configuration should
        be:
        Host: 10.10.10.22    (whatever the IP address is that you assigned it)
        Port: 3001           (not configurable)

15.9  Endian Conversion Utilities

      wview provides two command-line utilities to convert wview archive directories
      from Big Endian-to-Little Endian or Little Endian-to-Big Endian. These are 
      necessary if you want to change your wview host from a Mac/NSLU2 to a PC or
      vice versa.

15.9.1  arc_be2le

      Usage: arc-be2le [source_directory] [dest_directory]

      Convert wview archive data in [source_directory] from big endian
      to little endian then store the result in [dest_directory]

15.9.2  arc_le2be

      Usage: arc_le2be [source_directory] [dest_directory]

      Convert wview archive data in [source_directory] from little endian
      to big endian then store the result in [dest_directory]
</pre>

<br><br>
<a name="16. CWOP - Submitting Your Data to NOAA and the CWOP System"></a>
<hr size=2 noshade>
<h2>16. CWOP - Submitting Your Data to NOAA and the CWOP System</h2>
<pre>
16.1  Overview

   CWOP (Citizen Weather Observer Program, http://www.wxqa.com/) is a system by 
   which individuals with weather stations and the proper software can submit 
   their weather data to an APRS-based data storage system so that anyone, 
   including NOAA, can use the data however they see fit. There are some really 
   neat station display web sites including some java apps to look up station 
   data, position, maps, etc. 
   
   As an example, see http://www.findu.com/cgi-bin/wxpage.cgi?call=CW4097 
   for my weather station.
   
   CWOP participation requires registering for an APRS "Call Sign". Once you 
   have configured wview for CWOP properly and confirmed your data online, you
   must contact the maintainers via email to confirm your registration. Then 
   your data will be available for anyone to see and possibly be used in NOAA 
   forecast models, etc. Pretty cool, eh?

   When CWOP support is enabled and configured properly, wview will transmit 
   a new WX packet to the APRS server each time a new archive record is 
   generated. Thus archive interval drives the frequency that your CWOP data 
   will be updated.
   
   Supports the APRS-IS Rollover functionality by enforcing the definition of 
   3 APRS-IS server:port pairs - the goal is to avoid data loss to the CWOP 
   system caused by connection errors. Select 3 different servers from the list 
   at http://www.wxqa.com/activecwd.html - be advised, the arizona server is 
   heavily burdened and often refuses connections.

16.2  Prerequisites

   - Internet connection/firewall which allows TCP port 23 connections out
   - Accurate Latitude and Longitude values in the proper format (this is 
     not the same location info used for general station configuration, higher
     precision is required by CWOP)
   - 3 APRS Servers (see http://www.wxqa.com/activecwd.html for the list)
   - 3 APRS Port Numbers, one for each server (usually 23)
   - APRS Call Sign (CWnnnn)

16.3  Register for an APRS Call Sign (unless you already have one):

      http://www.findu.com/citizenweather/signup.html

16.4  Determine your accurate latitude and longitude:

      http://www.topozone.com/viewmaps.asp

16.4  Enable CWOP support in wview:

16.4.1  You must have wview version 1.6.0 or later

16.4.2  Execute the wviewconfig script:

        $prefix/bin/wviewconfig
   
        [just hit return to keep your current settings when prompted]
   
        > Enable CWOP (Citizen Weather Observer Program) support?"
        > (no):  

        Answer with a "yes" to this question - then specify the CWOP parameters as 
        prompted.
        Note: You must specify all 3 APRS servers - the goal is to avoid data loss

16.5  If you are upgrading from a version prior to 1.6.0, copy the new wview 
      run script including CWOP daemon support:

      cp wview-x.y.z/examples/[your_distro]/wview [your_distro_start_script_location]

16.6  Start wview

      [your_distro_start_script_location]/wview start

16.7  Check the wview logs for wvcwopd activity

      As said before, your archive interval determines how often wview will 
      update your weather data to the CWOP system. The first record should be 
      generated at the next archive record generation after wview has started.
      Confirm that wvcwop logs are indicating successful connections to the 
      APRS server. 
      
      Look in /var/log/messages for something similar to:
      
      "CWOP: configured to submit station CW4097 data to:"
      "CWOP: Primary:   cwop.aprs.net:23"
      "CWOP: Secondary: cwop.aprs.net:23"
      "CWOP: Tertiary:  cwop.aprs.net:23"
      
      during initialization, and:
      
      "CWOP-sending: CW4097>APRS,TCPXX*,qAX,CW4097:@132235z3334.14N/09654.66W_284/002g005t093P002h40b10131.wview160"
      
      at the arrival of each new archive record.

16.8  Confirm your data in the CWOP stream:

      Goto http://www.findu.com/cgi-bin/wxpage.cgi?call=CWxxxx where CWxxxx is 
      your Call Sign. This should start displaying your weather data graphically 
      with links on the left for looking at your raw data. Make sure it is all 
      good - there is much information and many sites to visit to help you verify 
      your data. Just start at http://www.wxqa.com/activecwd.html.

16.9  When all is good, send an email to the CWOP maintainers. Congratulations, 
      you are now contributing data for the greater good!

<br><br>
<a name="17. Wunderground/Weatherforyou - Submitting Your Data to Weather Underground and/or Weatherforyou"></a>
<hr size=2 noshade>
<h2>17. Wunderground/Weatherforyou - Submitting Your Data to Weather Underground and/or Weatherforyou</h2>
<pre>
17.1  Overview

   The Weather Underground (www.wunderground.com/) (Wunderground) is a privately 
   held organization which provides many weather services - some free and some 
   not. Among the free services is the ability to register your weather station 
   and submit your data to them so that you can access your data and some nice 
   graphs from their site. Weatherforyou.com is also a privately held outfit
   with similar capabilities to wunderground.

17.2  Prerequisites

   - Internet connection/firewall which allows HTTP connections out
   - Accurate Latitude and Longitude values in the proper format
   - libcurl, a "C" URL library distributed with the command line "curl" utility 
     (see the Prerequisites section above for details)
   - A registered Weather Underground/Weatherforyou Station ID

17.3  Wunderground

17.3.1  Register for a Weather Underground Station ID (unless you already have one):

        http://www.wunderground.com/weatherstation/usersignup.asp

17.3.2  Determine your accurate latitude and longitude:

        http://www.topozone.com/viewmaps.asp

17.3.3  Enable Wunderground support in wview:

17.3.3.1  You must have wview version 3.4.0 or later

17.3.3.2  Configure wview to include Wunderground support (libcurl required):

          ./configure [station_enable_str] --enable-http
          make install

17.3.3.3  Execute the wviewconfig script:

          /usr/local/bin/wviewconfig
   
          [just hit return to keep your current settings when prompted]
   
          > Enable WUNDERGROUND support?
          > (no):  

          Answer with a "yes" to this question - then specify the Wunderground 
          parameters as prompted.

17.3.4  If you are upgrading from a version prior to 3.4.0, copy the new wview 
        run script including Wunderground/Weatherforyou daemon support:

        cp wview-x.y.z/examples/[your_distro]/wview [your_distro_start_script_location]

17.3.5  Start wview

        [your_distro_start_script_location]/wview start

17.4  Weatherforyou

17.4.1  Register for a Weatherforyou Station ID (unless you already have one):

        http://www.hamweather.net/weatherstations/
        Login there and click on 'Add New' on the 'User Stations' line. 
        Then enter your station's information.

17.4.2  Enable Weatherforyou support in wview:

17.4.2.1  You must have wview version 3.4.0 or later

17.4.2.2  Configure wview to include Weatherforyou support (libcurl required):

          ./configure [station_enable_str] --enable-http
          make install

17.4.2.3  Execute the wviewconfig script:

          /usr/local/bin/wviewconfig
   
          [just hit return to keep your current settings when prompted]
   
          > Enable WEATHERFORYOU support?
          > (no):  

          Answer with a "yes" to this question - then specify the Weatherforyou 
          parameters as prompted.

17.4.3  If you are upgrading from a version prior to 3.4.0, copy the new wview 
        run script including Wunderground/Weatherforyou daemon support:

        cp wview-x.y.z/examples/[your_distro]/wview [your_distro_start_script_location]

17.4.4  Start wview

        [your_distro_start_script_location]/wview start

17.5  Check the wview logs for wvhttpd activity

      Your archive interval determines how often wview will update your weather 
      data to the Wunderground/Weatherforyou systems. The first record should be 
      generated at the next archive record generation after wview has started.
      
      Look in /var/log/messages for something similar to:
      
      "WUNDERGROUND: configured to submit station KTXCOLLI1 data to wunderground.com"
      "WEATHERFORYOU: configured to submit station KTXCOLLI1 data to weatherforyou.com"
      
17.6  Confirm your data at the Wunderground server:

      Goto http://www.wunderground.com/weatherstation/WXDailyHistory.asp?ID=XXXXXXX
      where XXXXXXX is your Wunderground Station ID. This should start displaying 
      your weather data graphically and as a packet list.

17.7  Confirm your data at the Weatherforyou server:

      Goto http://www.hamweather.net/weatherstations/pwsupdate.php?ID=XXXXXXX
      where XXXXXXX is your Weatherforyou Station ID. This should start displaying 
      your weather data as a packet list.
</pre>


<br><br>
<a name="18. AWEKAS - Providing Your Data to Awekas"></a>
<hr size=2 noshade>
<h2>18. AWEKAS - Providing Your Data to Awekas</h2>
<pre>
18.1  Overview

   From the AWEKAS site (<a href="http://www.awekas.at/en/index.php">http://www.awekas.at/en/index.php</a>):
   "AWEKAS is an acronym for "Automatisches WEtterKArten System" (= automatic 
   weather map system) and is, as the name already states, a system which produces 
   overview maps from the data from private weather stations. The values are made 
   available by the participants on their websites as Text or CSV files and are 
   collected by the programme. The process is fully automatic and always provides 
   maps with up to date weather situations."

   Simply put, if we provide the properly formatted HTML template to wview, AWEKAS
   will periodically poll the resulting HTML file for data and store it in their 
   database for online retrieval.

18.2  Configure wview to Generate the AWEKAS File

   Copy the appropriate template file (this assumes you have the latest distro HTML
   templates installed in $prefix/etc/wview/html):
   
   If you have a metric setup do the following:
       cp $prefix/etc/wview/html/awekas_wl.htx-metric $prefix/etc/wview/html/awekas_wl.htx

   Else if you have a US (Imperial) setup do the following:
       cp $prefix/etc/wview/html/awekas_wl.htx-us $prefix/etc/wview/html/awekas_wl.htx

   Add (or uncomment if already there) this template in $prefix/etc/wview/html-templates.conf:
       vi $prefix/etc/wview/html-templates.conf
       
       [Add the following lines or just remove the '#' from awekas_wl.htx if already there]
       [snip]
       ###############################################################################
       ### AWEKAS Data Submission Template
       ###############################################################################

       awekas_wl.htx
       [/snip]

   Restart wview:
       [your_start_script_location]/wview restart

   That's it! Once you have registered with AWEKAS this file should be polled by them
   periodically to update your station data.

</pre>


<br><br>
<a name="19. Using a Linksys NSLU2 as the wview Host"></a>
<hr size=2 noshade>
<h2>19. Using a Linksys NSLU2 as the wview Host</h2>
<pre>
19.1  Overview

   The Linksys NSLU2 is a network storage link which uses USB external hard 
   drives or flash drives and an ethernet interface to provide Network Attached
   Storage (NAS) to the masses. This is a perfect embedded platform to use as a
   wview host. It is small, inexpensive (~$70) and uses little power. In addition,
   there exists a mature linux hacking community which has developed an entire open 
   source distribution including a simple package management system. We will 
   use one USB port for our boot disk and root partition hard drive and the 
   other USB port for the USB-to-serial interface to the VP console. One could 
   also use one of the wview-approved terminal servers to interface the VP 
   console via ethernet.

   The distribution we will use is SlugOS: 
   (<a href="http://www.nslu2-linux.org/wiki/SlugOS/HomePage">http://www.nslu2-linux.org/wiki/SlugOS/HomePage</a>).
   Big-Endian (BE) and Little-Endian (LE) variants are available.  If you use the LE
   version you will be able to use the archive files generated by wview directly on a
   PC, whereas with the BE version you would need to run the conversion utilities first.

   Another alternative is Debian - see (<a href="http://www.nslu2-linux.org/wiki/Debian/HomePage">http://www.nslu2-linux.org/wiki/Debian/HomePage</a>).
   
   On all of these platforms it is fairly easy to set up a development environment
   and install wview from source just like on any other distro 
   (see <a href="http://www.nslu2-linux.org/wiki/HowTo/SetupANativeCompiler"> http://www.nslu2-linux.org/wiki/HowTo/SetupANativeCompiler</a>), but we also provide precompiled binaries for SlugOS.

19.2  Install Openslug

   Download the SlugOS 4.8-beta binary: 
       <a href="http://www.slug-firmware.net/s-dls.php">http://www.slug-firmware.net/s-dls.php</a>

   Flash the NSLU2 with the SlugOS binary: 
       <a href="http://www.nslu2-linux.org/wiki/SlugOS/UsingTheBinary">http://www.nslu2-linux.org/wiki/SlugOS/UsingTheBinary</a>

   Initialize your hard disk and transfer the root filesystem:
       <a href="http://www.nslu2-linux.org/wiki/OpenSlug/InitialisingOpenSlug">http://www.nslu2-linux.org/wiki/OpenSlug/InitialisingOpenSlug</a>

    For SlugOS the flash/disk requirements are quite modest - a 512MB flash drive 
    should suffice.

    It is recommended to set up a swap area.  In normal use wview installed alone
    on an NSLU2 does not cause swapping, but sometimes things like 'ipkg update' 
    need more memory than is physically available.

19.3  Prepare ipkg to use the wview repository

   Once you have your slug (NSLU2) booting from the USB hard drive/flash, do the 
   following to enable the wview ipkg repository:

   Obtain the wview ipkg config file:
       cd /etc/ipkg
       wget http://www.wviewweather.com/ipkg/wview.conf

   Configure ipkg:
       ipkg update

19.4  Install a USB-to-Serial Adapter Driver

   Note: If you are using a terminal server via ethernet, you can skip this step.

   There are a wide range of supported USB Serial devices, including:

    Module Name                ipkg Name
    -----------                -------------------------------
    BELKIN                     kernel-module-belkin-sa
    CP2101                     kernel-module-cp2101
    CYPRESS_M8                 kernel-module-cypress-m8
    DIGI_ACCELEPORT            kernel-module-digi-acceleport
    EDGEPORT                   kernel-module-io-edgeport
    EDGEPORT-TI                kernel-module-io-ti
    EMPEG                      kernel-module-empeg
    FTDI_SIO                   kernel-module-ftdi-sio
    KEYSPAN                    kernel-module-keyspan
    MCT_U232                   kernel-module-mct-u232
    PL2303                     kernel-module-pl2303
    SAFE                       kernel-module-safe-serial
    TI                         kernel-module-ti-usb-3410-5052
    WHITEHEAT                  kernel-module-whiteheat

   Choose the ipkg name corresponding to your USB-to-Serial adapter - 
   to generalize we'll refer to it as [usb-pkg-name]. Use "ipkg list"
   to see descriptions of the individual packages if unsure which one 
   is right for your adapter. You will have to look in the "/dev"
   directory of your slug to determine the proper device name for your
   adapter/driver to give the wviewconfig script (after the driver is 
   installed and the USB-to-serial adapter is connected). USB adapters
   are considered serial devices by wview.

   Install the kernel module driver:
       # ipkg install [usb-pkg-name]

   Setup the module to be loaded at boot:
       (Note: [module name] is the ipkg Name above without the leading 
        "kernel-module-")

       # echo [module name] > /etc/modutils/[module name]
       # /usr/sbin/update-modules
       # ln -s /etc/init.d/modutils.sh /etc/rc3.d/S90modutils

19.5  Installing wview and All Prerequisites

   Determine the type of wview to install:
       # ipkg list | grep wview
       wview-sim-mysql - 3.5.0-r0 - Version 3.5.0 of package wview
       wview-vpro-mysql - 3.5.0-r0 - Version 3.5.0 of package wview
       wview-wxt510-mysql - 3.5.0-r0 - Version 3.5.0 of package wview

   Install wview and dependencies:
       # ipkg install wview-[type]

   This will install radlib, gd, libpng, libjpeg, libz, libcurl and a few 
   other necessities. It will install an appropriate wview start/stop script 
   in /etc/init.d and configure it to run at boot. It will install default 
   config files in $prefix/etc/wview and a default run environment in $prefix/var/wview. 
   Note that wview binaries are installed in /usr/bin on the slug.

   Install the ntpdate crontab:
   cd /etc/cron/crontabs
   crontab root

   Set your timezone:
       $ ln -s /usr/share/zoneinfo/[your continent]/[Your timezone] /etc/localtime

   Optional: If you plan to ftp your files off the slug to your webserver, you 
   will need to download the tnftp binary built for openslug 2.7-beta:
       # cd /usr/bin
       # mv /usr/bin/ftp /usr/bin/ftp-old

       (OpenSlug BE):
       # wget http://www.wviewweather.com/ipkg/tnftp
       (OpenSlug LE):
       # wget -O tnftp http://www.wviewweather.com/ipkg/tnftp-LE

       # chmod +x tnftp
       # ln -s /usr/bin/tnftp /usr/bin/ftp
   You can also download the tnftp tarball at:
   http://www.wviewweather.com/ipkg/tnftp-20050625.tar.gz
   and build tnftp natively on the slug (development setup on the slug required).

19.6  Finishing Up

   Now you should proceed to the <a href="#6. Configuration">Configuration</a>
   section of this manual (skipping the first two sections) and configure your 
   wview installation. When you are done, reboot the slug and confirm proper 
   operation. You will probably want to install the nfs-utils package and/or 
   samba so you can transfer files to/from your slug. These are described on the 
   openslug Wiki - look around and have fun with your slug!

19.7  Upgrading

   If upgrading a previous version of wview:
       # /etc/init.d/wview stop
       # mv $prefix/etc/wview $prefix/etc/wview-OLD
       # mv $prefix/var/wview/img $prefix/var/wview/img-OLD
       # cd /etc/ipkg
       # wget http://www.wviewweather.com/ipkg/wview.conf
       # ipkg update
       # ipkg install wview-[type]
       (merge your old configuration files into the new directories)
       # wviewconfig
</pre>


<br><br>
<a name="20. Porting New Stations To wview"></a>
<hr size=2 noshade>
<h2>20. Porting New Stations To wview</h2>
<pre>
20.1  Station API

   The wview station API is prototyped in ../stations/common/station.h. For 
   full details of the functional requirements please refer to station.h and
   existing station interfaces. The required functions of any station interface
   are (from station.h):
   
// station-supplied init function
// -- Can Be Asynchronous - event indication required --
//
// MUST (in this order):
//   - set the 'stationGeneratesArchives' flag in WVIEWD_WORK:
//     if the station generates archive records (TRUE) or they should be 
//     generated automatically by the daemon from the sensor readings (FALSE)
//   - Initialize the 'stationData' store for station work area
//   - Initialize the interface medium
//   - determine the station archive interval - either from the station itself
//     or from user configuration in wview-conf.sdb - and set the 
//     'work->archiveInterval' variable (in minutes) in WVIEWD_WORK
//   - VERIFY the archive interval by calling 'stationVerifyArchiveInterval' -
//     If they don't match, indicate an errant start via the call:
//     radProcessEventsSend (NULL, STATION_INIT_COMPLETE_EVENT, 1)
//     and stopping further init activities here!
//   - do any catch-up on archive records if there is a data logger (can be 
//     asynchronous) - the 'work->runningFlag' can be used for start up 
//     synchronization but should not be modified by the station interface code
//   - do initial LOOP acquisition
//   - indicate successful initialization is done via the call:
//     radProcessEventsSend (NULL, STATION_INIT_COMPLETE_EVENT, 0)
//
// OPTIONAL:
//   - Initialize a state machine or any other construct required for the 
//     station interface - these should be stored in the 'stationData' store
//
// 'archiveIndication' - indication callback used to pass back an archive record
//   generated as a result of 'stationGetArchive' being called; should receive a
//   NULL pointer for 'newRecord' if no record available; only used if 
//   'stationGeneratesArchives' flag is set to TRUE by the station interface
//
// Returns: OK or ERROR
//
extern int stationInit
(
    WVIEWD_WORK     *work,
    void            (*archiveIndication)(ARCHIVE_RECORD *newRecord)
);


// station-supplied exit function
//
// Returns: N/A
//
extern void stationExit (WVIEWD_WORK *work);


// station-supplied function to retrieve positional info (lat, long, elev) -
// should populate WVIEWD_WORK fields: latitude, longitude, elevation
// -- Synchronous --
//
// - If station does not store these parameters, they can be retrieved from the
//   wview-conf.sdb file (see the 'stationGetConfigValue' utilities below) - user 
//   must choose station type "NameOfStation" when running the wviewconfig script
//
// Returns: OK or ERROR
//
extern int stationGetPosition (WVIEWD_WORK *work);


// station-supplied function to indicate a time sync should be performed if the
// station maintains time, otherwise may be safely ignored
// -- Can Be Asynchronous --
//
// Returns: OK or ERROR
//
extern int stationSyncTime (WVIEWD_WORK *work);


// station-supplied function to indicate sensor readings should be performed -
// should populate 'work' struct: loopPkt (see datadefs.h for minimum field reqs)
// -- Can Be Asynchronous --
//
// - indicate readings are complete by sending the STATION_LOOP_COMPLETE_EVENT
//   event to this process (radProcessEventsSend (NULL, STATION_LOOP_COMPLETE_EVENT, 0))
//
// Returns: OK or ERROR
//
extern int stationGetReadings (WVIEWD_WORK *work);


// station-supplied function to indicate an archive record should be generated -
// MUST populate an ARCHIVE_RECORD struct and indicate it to 'archiveIndication'
// function passed into 'stationInit'
// -- Asynchronous - callback indication required --
//
// Returns: OK or ERROR
//
// Note: 'archiveIndication' should receive a NULL pointer for the newRecord if
//       no record is available
// Note: This function will only be invoked by the wview daemon if the 
//       'stationInit' function set the 'stationGeneratesArchives' to TRUE
//
extern int stationGetArchive (WVIEWD_WORK *work);


// station-supplied function to indicate data is available on the station 
// interface medium (serial or ethernet) -
// It is the responsibility of the station interface to read the data from the 
// medium and process appropriately. The data does not have to be read within
// the context of this function, but may be used to stimulate a state machine.
// -- Can Be Asynchronous --
//
// Returns: N/A
//
extern void stationDataIndicate (WVIEWD_WORK *work);


// station-supplied function to indicate the interface timer has expired -
// It is the responsibility of the station interface to start/stop the interface
// timer as needed for the particular station requirements.
// The station interface timer is specified by the 'ifTimer' member of the
// WVIEWD_WORK structure. No other timers in that structure should be manipulated
// in any way by the station interface code.
// -- Can Be Asynchronous --
//
// Returns: N/A
//
extern void stationIFTimerExpiry (WVIEWD_WORK *work);

20.2  Notes

   - Two events are used for notification to the generic wviewd daemon:
     STATION_INIT_COMPLETE_EVENT    used to asynchronously indicate station-
                                    specific initialization is complete
     STATION_LOOP_COMPLETE_EVENT    used to asynchronously indicate that a 
                                    current readings acquisition is complete

   - If the station does not include a data logger, the generic wviewd daemon
     will generate archive records based on the current readings samples for the
     archive interval. See the WXT510 implementation for an example of a
     straightforward synchronous station interface. It does not include a data 
     logger and requires the wview daemon to generate archive records. The 
     Simulator station implementation also demonstrates a synchronous interface.

   - If the station does include a data logger, the archiveIndication function
     allows an asynchronous way to indicate the archive record to the wview 
     daemon. See the VantagePro station implementation for an asynchronous, 
     state-machine driven station interface.

   - A station-specific work data store pointer is provided in the WVIEWD_WORK
     structure to allow the definition and reference of station-specific data
     (including state machines, etc.).

   - If the station does not configure/store location data, the station config
     parameter utility can be used to extract them from wview-conf.sdb (see 
     stations/Simulator/simulator.c for example usage).

</pre>

<br><br>
<a name="21. Sensor Calibration"></a>
<hr size=2 noshade>
<h2>21. Sensor Calibration</h2>
<pre>
21.1  Overview

   Software calibration of basic sensors for any station type are configured using
   the wview-conf.sdb configuration database. Archive data and loop data used for 
   highs/lows/averages is calibrated before being stored to file or sent to external
   data consumers (CWOP, WeatherUnderground, Alarms, etc.).
   The format of the calibration equation is:
   CSV = M * X + C, where:
       CSV  is the calibrated sensor value
       M    is the multiplier configuration value in wview-conf.sdb
       X    is the raw sensor value
       C    is the constant configuration value in wview-conf.sdb

21.2  Sensor List

   The following sensors can be calibrated:
   Sensor                   Units
   ------------------       -----------------
   Barometer                US inches
   Station Pressure         US inches
   Altimeter                US inches
   Inside Temp              degrees fahrenheit
   Outside Temp             degrees fahrenheit
   Inside Humidity          %
   Outside Humidity         %
   Wind Speed               miles per hour (mph)
   Wind Direction           degrees (0-359)
   Rain                     US inches
   Rain Rate                US inches per hour

21.3  Pressure Calibration

   Each station type produces one type of pressure sensor: Barometric Pressure (BP),
   Station Pressure (SP) or Altimeter (ALT). wview converts the sensor provided
   to the other two types algorithmically. As of the 5.0.0 release, it is only 
   necessary to calibrate the pressure type provided by your station - wview will
   apply the calibration prior to the conversion to the other two types. Calibration 
   values entered for the two derived types will be ignored by wview.

   Station           Pressure Type to Calibrate
   ----------------  --------------------------
   Vantage Pro       BP
   WXT510            SP
   WS-2300           SP
   WMR918            SP

   Regardless of the type your are calibrating, you will generally be using the
   BP value to compare to local stations. Just remember to adjust the sensor
   calibration for the native pressure of your station.

21.4  Notes

   Calibration is done in US units only. Yes, imperial. Station data is always
   received/stored in imperial units. Thus calibration is done in imperial units.
   If you are a metric station, *figure out* what the imperial equivalent for 
   your metric calibration would be, and use that for the calibration settings.

</pre>


<br><br>
<a name="22. Data Stored in SQLite3 (And How to Use It)"></a>
<hr size=2 noshade>
<h2>22. Data Stored in SQLite3 (And How to Use It)</h2>
<pre>
22.1  Overview

   With the release of wview version 5.0.0 archive data is no longer stored in
   the Weatherlink WLK file format. wview now stores archive data in an SQLite3
   database, namely $prefix/var/wview/archive/wview-archive.sdb. This will allow
   much easier data viewing, modifying and post-processing. Version 5.1.0 added
   a new HILOW data store in the database $prefix/var/wview/archive/wview-hilow.sdb.
   Version 5.2.0 added NOAA data to the database $prefix/var/wview/archive/wview-noaa.sdb.
   This section will describe each of these databases including when and from what
   data they are created/updated.

22.2  Database Origins

   Database             Data Source                     How Generated
   ------------------   ------------------------------- -------------------------------
   wview-archive.sdb    WLK conversion via wlk2sqlite   Not autogenerated - requires
                        or stored run time by wview     an existing template (found at
                                                        $distro/bin/archive/wview-archive.sdb)

   wview-hilow.sdb      Archive records for initial     Autogenerated during wview init 
                        creation; LOOP packets during   (can be very slow on some platforms);
                        run time by wview               Offline creation via the hilowcreate
                                                        utility

   wview-noaa.sdb       HILOW records for initial       Autogenerated during wview init
                        creation and during run time    (not too long to generate)

22.3  What to Protect and Why

   wview-archive.sdb    - do NOT delete this database without a backup copy; this file
                          should be backed up for data security

   wview-hilow.sdb      - if you delete this file, wview will regenerate it but you
                          will lose the higher resolution of LOOP data as wview can
                          only use archive records for historical generation; this
                          file should be backed up for data security

   wview-noaa.sdb       - there is no data loss associated with deleting this database
                          and letting wview regenerate it during init

22.4  Archive Data (wview-archive.sdb)

22.4.1  Conversion from WLK to SQLite3

   A conversion utility, wlk2sqlite is now provided as part of the wview
   distribution.
   
   > wlk2sqlite source_directory [destination_directory]

   source_directory is a required argument but can be the same as [destination_directory] -
   I typically use the default archive file location for my install, 
   $prefix/var/wview/archive, since there is nothing destructive about the 
   conversion with respect to the old WLK files, it only reads them.

   So an example using the default prefix /usr/local would be:
   > sudo wlk2sqlite /usr/local/var/wview/archive
   This places the newly populated SQLite3 archive database file in the proper
   location for wview 5.0.0 + operation.

   Note: The conversion can take some time depending upon your platform and how
         much archive data you have.

   When the conversion is complete, you have one coherent archive database.

22.4.2  Viewing/Modifying Your Data With the sqlite3 CLI Utility

   Let's look at your data.
   > sudo sqlite3 /usr/local/var/wview/archive/wview-archive.sdb

   sqlite> .help
   (This displays available commands; non-SQL commands begin with '.')

   sqlite> select * from archive;
   (This displays every column of every row)

   sqlite> .schema archive
   (This displays the CREATE statement for the archive table including column
    names)

   sqlite> update archive set altimeter='777.88' where altimeter is NULL;
   (This changes the value of column altimeter wherever it is NULL)

   sqlite> .dump archive
   (This dumps every row of the archive table in SQL format - very handy for 
   moving your table from one platform to another)

   Note: SQL syntax as recognized by SQLite3 is documented at: 
         http://www.sqlite.org/lang.html

22.4.3  Moving Your Data to a Different Platform

   This is where having our data in an SQL database starts to pay off.

   Dump the archive table in SQL format:
   > sudo sqlite3 /usr/local/var/wview/archive/wview-archive.sdb .dump > ~/temp/[my_sql_filename]

   Copy [my_sql_filename] to the target platform.

   On the target platform:
   > sudo sqlite3 [new_database_filename] .read [my_sql_filename]
   (This will execute each SQL statement in [my_sql_filename] for the new database
   [new_database_filename])

   Done!

22.4.4  Why Can't I Just Move the Database File?

   Physical platform and version of SQLite3 effect the format of the data in your
   archive database.

22.5  HILOW Data (wview-hilow.sdb)

22.5.1  Overview

   The database $prefix/var/wview/archive/wview-hilow.sdb will be created and 
   back-filled using archive records for all records in the archive database. 
   This initialization process can take some time (8-12 minutes per year) but 
   is only required during the first run of wview after an upgrade >= 5.1.0.
   Once $prefix/var/wview/archive/wview-hilow.sdb has been created and back-filled,
   wview will add each LOOP sample to the HILOW database.

22.5.2  Structure

   The $prefix/var/wview/archive/wview-hilow.sdb database has one table for each
   of the supported sensor types (i.e., inTemp, outTemp, ... rain, rainRate).
   Each table contains a record for each hour. The data starts with your earliest 
   archive record.

   The columns for each table are:
   dateTime         - timestamp for the beginning of the hour for this record
   low              - low value for this hour
   timeLow          - timestamp when the low occured
   high             - high value for this hour
   timeHigh         - timestamp when the high occured
   whenHigh         - additional value at the time of the high
                      (currently only used for wind direction when high wind occured)
   cumulative       - the sum of all samples in this record
   samples          - the number of samples in this record

   Thus the average for an hour is cumulative/samples.

   The windDir table has a unique structure.  Each row includes the dateTime stamp
   and 20 integer bins. Each wind direction reading is tallied in one of the 20 bins,
   with each bin representing an 18-degree window. These bins are used for consensus
   averaging (the algorithm is found in windAverage.c).

22.5.3  Samples Stored

   During creation, wview uses archive records to back-fill the HILOW database.
   During normal wview operation, LOOP samples are used to populate the HILOW 
   database, providing a much higher granularity for detecting low and high events.

22.5.4  Regeneration

   To regenerate the HILOW database:
   > /etc/init.d/wview stop
   > sudo rm $prefix/var/wview/archive/wview-hilow.sdb
   > /etc/init.d/wview start

   Note: Doing this will delete the LOOP sample resolution stored while wview is
         running, replacing it with back-filled archive data. For a station with
         a 5 minute archive interval and 30 second LOOP interval, that is the 
         difference between 120 samples per hour and 12 samples per hour.

22.6  NOAA Data (wview-noaa.sdb)

22.6.1  Overview

   The NOAA data is stored in an SQLite3 database. The database is generated 
   based on records in the HILOW database (much faster and more accurate than 
   archive records).

22.6.2  Structure

   Each record in wview-noaa.sdb represents one day. The columns for the 
   noaaHistory table are:
   dateTime         - timestamp for the beginning of the day for this record
   meanTemp         - average temperature for the day
   highTemp         - high temperature for the day
   highTempTime     - unix time of high
   lowTemp          - low temperature for the day
   lowTempTime      - unix time of low
   heatDegDays      - heat degree days for the day
   coolDegDays      - cool degree days for the day
   rain             - rain for the day
   avgWind          - average wind for the day
   highWind         - high wind for the day
   highWindTime     - unix time of high wind
   domWindDir       - dominant wind direction for the day

22.6.3  Regeneration

   To regenerate the NOAA database:
   > /etc/init.d/wview stop
   > sudo rm $prefix/var/wview/archive/wview-noaa.sdb
   > /etc/init.d/wview start

22.7  Day history Table (wview-history.sdb)

22.7.1  Overview

   This table is generated internally by wview to avoid having to compute the 
   daily summary records used for the yearly charts every time wview starts.
   This was not a time concern with the flat WLK files but became more costly
   when we started storing data in SQLite3. The external use or utility of this 
   table is limited at best.

22.7.2  Regeneration

   To cause the day history table to be regenerated, stop wview, delete 
   wview-history.sdb and start wview.

22.8  SQLite3 Tips

   To display the dateTime timestamp of any table as local time:
   sqlite> select datetime(dateTime, 'unixepoch', 'localtime') from archive;

   To fix any archive entries having 255 for the outHumidity:
   sqlite> update archive set outHumidity = '50' where outHumidity = '255';
   (Note: If you modify records in the archive table, you will probably want to
    regenerate the HILOW tables.)

    
</pre>

<br><br>
<a name="23. wviewmgmt - The New Way to Manage wview"></a>
<hr size=2 noshade>
<h2>23. wviewmgmt - The New Way to Manage wview</h2>
<pre>
23.1  Overview

   Included in the wview distribution ($distro/wviewmgmt) is a PHP/Java/HTML web site
   for managing your wview installation via a web interface.
   Features include:

   - Graphical configuration of wview (running or not)
   - Ability to remotely Start/Stop wview
   - Run status display

23.2  Setup

   Note: Replace $prefix, $distro and $documentRoot with the appropriate paths 
         for your server.

   1) Configure wview with HTTP_DOC_ROOT defined (see the build and install section).

   2) Use the make install build target:
      > make install

   3) Be sure PHP support is included with the http server:
      For apache2, I have /etc/apache2/mods-enabled/php5.conf and 
      /etc/apache2/mods-enabled/php5.load.

   4) Be sure the SQLite3 module for php is installed (php5-sqlite or similar).

   5) If you want start/stop control of wview from the Management Web Site
      (and you are comfortable giving the http server user account sudo privileges),

      a) Add the http user to the sudo group:
         > sudo adduser www-data sudo

      b) Make sure the sudo group has no password required privileges in /etc/sudoers:
         > sudo visudo
         (Make sure the line [%sudo ALL=NOPASSWD: ALL] is at the bottom of the
          /etc/sudoers file)

   6) Point your browser to: 
      http://[wview_URL_or_IP_address]/wviewmgmt/login.php

   7) The default password is "wview". You should change this the first time you 
      login. There is no reminder capability, so if you forget it, delete the row
      in the wview-config.sdb database with name "ADMIN_PASSWORD", logout and start
      again with "wview".

23.3  Notes

   The addition of the http user to the sudoers file may be a security vulnerability -
   use it at your own risk.
   
   The Start/Stop button is not a toy - every effort has been made to harden it
   so you don't punch it like a child - but if you refresh your browser while you
   should be waiting patiently for wview to start or stop then push the button
   again, you will probably hose up your installation. So use it with care.

</pre>

<br><br>
<a name="24. Troubleshooting"></a>
<hr size=2 noshade>
<h2>24. Troubleshooting</h2>
<pre>
24.1  wview Processes

   Please note there are two unix processes for each wview daemon: this is 
   normal radlib operation. One is the actual daemon and the other is a 
   "reflector" process which allows the daemon to send events to itself and 
   to open the message queue FIFO properly. Don't let that bother you. 
   
   Here are the processes running on my server (no ssh/ftp because I don't 
   need it):

    root@localhost:/root# ps aux | grep wv
    root     73863  0.0  0.2  2320 1808  ??  Ss    7:08AM   0:00.02 /usr/local/bin/radmrouted 1 $prefix/var/wview
    root     73865  0.0  0.2  2300 1780  ??  I     7:08AM   0:00.00 /usr/local/bin/radmrouted 1 $prefix/var/wview
    root     73868  0.0  0.1  2380 1472  ??  Ss    7:08AM   0:00.36 /usr/local/bin/wviewd
    root     73870  0.0  0.1  2356 1196  ??  I     7:08AM   0:00.00 /usr/local/bin/wviewd
    root     73873  0.0  0.1  2376 1524  ??  Is    7:08AM   0:35.43 /usr/local/bin/wviewsqld
    root     73875  0.0  0.1  2324 1140  ??  I     7:08AM   0:00.00 /usr/local/bin/wviewsqld
    root     73879  0.0  0.1  2336 1468  ??  Ss    7:08AM   0:00.01 /usr/local/bin/wvalarmd
    root     73881  0.0  0.1  2312 1136  ??  I     7:08AM   0:00.00 /usr/local/bin/wvalarmd
    root     73882  0.0  0.1  2392 1504  ??  Is    7:08AM   0:00.01 /usr/local/bin/wvcwopd
    root     73884  0.0  0.1  2304 1136  ??  I     7:08AM   0:00.00 /usr/local/bin/wvcwopd
    root     73885  0.0  0.3  4944 3100  ??  Is    7:08AM   0:00.03 /usr/local/bin/wvhttpd
    root     73886  0.0  0.2  4788 2216  ??  I     7:08AM   0:00.00 /usr/local/bin/wvhttpd
    root@localhost:/root# ps aux | grep htmlgen
    root     73876  0.0  0.3  3960 2800  ??  Is    7:08AM   0:05.82 /usr/local/bin/htmlgend
    root     73878  0.0  0.2  3860 1964  ??  I     7:08AM   0:00.00 /usr/local/bin/htmlgend
    root@localhost:/root#
    
    This indicates I have 6 wview daemons running: wviewd, htmlgend, wviewsqld,
    wvalarmd, wvcwopd and wvhttpd. It also displays the radlib message router
    process radmrouted.

24.2  SYS V IPC (Interprocess Communication)

   wview uses many radlib facilities which are based on the system V IPC 
   concepts of shared memory and semaphores.
   
   Here is a listing of IPC objects while wview is running (FreeBSD):

    root@localhost:/root# ipcs
    Message Queues:
    T     ID     KEY        MODE       OWNER    GROUP
    
    Shared Memory:
    T     ID     KEY        MODE       OWNER    GROUP
    m 4128768     126979 --rw-rw-r--     root    wheel
    m 4128769     126977 --rw-rw-r--     root    wheel
    m 4128770  267386882 --rw-rw-r--     root    wheel
    
    Semaphores:
    T     ID     KEY        MODE       OWNER    GROUP
    s 4128768  267386881 --rw-r--r--     root    wheel
    s 4128769     126978 --rw-r--r--     root    wheel
    root@localhost:/root#
    
    And, after running /etc/rc.d/wview stop:
    
    root@localhost:/root# /etc/rc.d/wview stop
    Shutting down weather daemons...
    root@localhost:/root# ipcs
    Message Queues:
    T     ID     KEY        MODE       OWNER    GROUP
    
    Shared Memory:
    T     ID     KEY        MODE       OWNER    GROUP
    
    Semaphores:
    T     ID     KEY        MODE       OWNER    GROUP
    root@localhost:/root#

    Linux systems tend to have other IPC objects defined - you do not want to 
    disturb those. The wview objects are discernable by the "KEY" values:
    126977 (0x1F001) - 126979 (0x1F003)             (wview-specific) 
    267386881 (0xFF00001) - 267386882 (0xFF00002)   (radlib general)

    If, after shutting down wview, any of the IPC objects associated with wview
    (or radlib) still remain, you will need to remove them manually using the
    "ipcrm" command. This is normally caused by failed wview starts when 
    initially installing wview with improper configuration or by a faulty wview
    start/stop script which is leaving wview processes running.

24.3  wview Startup

   wview generates a number of log messages, in particular during 
   initialization. The system log file is normally /var/log/messages. I 
   typically run "tail -f /var/log/messages" in a separate console when 
   starting up wview. You should also when you first install it. Informational 
   logs can later be disabled by editing wview-conf.sdb then sending a HUP signal
   to wviewd and htmlgend: (kill -s HUP `cat $prefix/var/wview/wviewd.pid`) and 
   (kill -s HUP `cat $prefix/var/wview/htmlgend.pid`) respectively.
   
   If you have errors in your startup log, you will need to stop all wview 
   daemons using the wview start script (/etc/init.d/wview stop). These are 
   independent processes which will not shut down automatically if there is
   an error in one of them. You must use the wview script.
   
   Here is what the log file looks like on my server when wview starts up, so 
   you know what a good start looks like:

Apr 18 08:48:44 linuxquad radmrouted[11676]: <1240062524756> : radlib: radmrouted started as a daemon ...
Apr 18 08:48:44 linuxquad radmrouted[11676]: <1240062524764> : started on radlib system 1, workdir /usr/local/var/wview
Apr 18 08:48:44 linuxquad radmrouted[11676]: <1240062524764> : running...                                              
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525759> : radlib: wviewd started as a daemon ...                      
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525759> : wview 5.4.0 starting ...                                    
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525777> : station interface: serial ...                               
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525777> : Rain Season Start Month set to 1                            
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525777> : Rain Storm Start Trigger set to  0.05 in/hr                 
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525778> : Rain Storm Stop Time set to 12 hours                        
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525778> : Rain YTD preset set to 0.00 inches                          
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525778> : ET YTD preset set to 0.000 inches                           
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525778> : bad rain/ET YTD Year given, disabling...                                                           
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525778> : station polling interval set to 30 seconds                                                         
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525837> : HILOW: database OK                                                                                 
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525837> : HILOW: beginning normal LOOP operation                                                             
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525837> : -- Station Init Start --                                                                           
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525838> : station archive interval: 5 minutes                                                                
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525838> : Simulator station opened: 720 minute data generation period...                                     
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525839> : running...                                                                                         
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525839> : station location: elevation: 751 feet                                                              
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525839> : station location: latitude: 33.6 N  longitude: 96.9 W                                              
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525839> : initializing computed data values...                                                               
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525841> : computeDataAllTime: 200904                                                                         
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525846> : computeDataYear: 200904                                                                            
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525851> : computeDataMonth: 200904                                                                           
Apr 18 08:48:45 linuxquad wviewd[11680]: <1240062525856> : computeDataWeek: 20090414                                                                          
Apr 18 08:48:46 linuxquad wviewd[11680]: <1240062526054> : -- Station Init Complete --                                                                        
Apr 18 08:48:46 linuxquad wviewd[11680]: <1240062526055> : newest archive record: 2009-04-14 22:40                                                            
Apr 18 08:48:46 linuxquad htmlgend[11686]: <1240062526745> : radlib: htmlgend started as a daemon ...                                                         
Apr 18 08:48:46 linuxquad wvalarmd[11691]: <1240062526746> : radlib: wvalarmd started as a daemon ...                                                         
Apr 18 08:48:46 linuxquad htmlgend[11686]: <1240062526746> : generating to /usr/local/var/wview/img                                                           
Apr 18 08:48:46 linuxquad htmlgend[11686]: <1240062526746> : templates at /usr/local/etc/wview/html                                                           
Apr 18 08:48:46 linuxquad htmlgend[11686]: <1240062526747> : !! Dual units will be displayed !!                                                               
Apr 18 08:48:46 linuxquad htmlgend[11686]: <1240062526747> : Tag Search red-black tree: max black node tree height: 7                                         
Apr 18 08:48:46 linuxquad wvalarmd[11691]: <1240062526747> : ALARM daemon not enabled - exiting...                                                            
Apr 18 08:48:46 linuxquad wvcwopd[11696]: <1240062526747> : radlib: wvcwopd started as a daemon ...                                                           
Apr 18 08:48:46 linuxquad wvcwopd[11696]: <1240062526748> : CWOP daemon is NOT enabled - exiting...                                                           
Apr 18 08:48:46 linuxquad wviewftpd[11701]: <1240062526749> : radlib: wviewftpd started as a daemon ...                                                       
Apr 18 08:48:46 linuxquad wviewftpd[11701]: <1240062526750> : ftp daemon disabled - exiting...                                                                
Apr 18 08:48:46 linuxquad wviewsshd[11706]: <1240062526751> : radlib: wviewsshd started as a daemon ...                                                       
Apr 18 08:48:46 linuxquad wviewsshd[11706]: <1240062526752> : ssh daemon disabled - exiting...                                                                
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526753> : radlib: wvpmond started as a daemon ...                                                           
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: wviewd: 0                                                                                   
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: wviewd process monitoring is disabled                                                       
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: htmlgend: 0                                                                                 
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: htmlgend process monitoring is disabled                                                     
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: wvalarmd: 120                                                                               
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: pid file /usr/local/var/wview/wvalarmd.pid not present, disable monitoring...               
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: wvcwopd: 120                                                                                
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: pid file /usr/local/var/wview/wvcwopd.pid not present, disable monitoring...                
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: wvhttpd: 120                                                                                
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: pid file /usr/local/var/wview/wvhttpd.pid not present, disable monitoring...                
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: wviewsqld: 600                                                                              
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : PMON: pid file /usr/local/var/wview/wviewsqld.pid not present, disable monitoring...              
Apr 18 08:48:46 linuxquad wvpmond[11711]: <1240062526829> : running...                                                                                        
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527294> : running...                                                                                       
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527294> : received station info from wviewd: 20090414 22:40:00                                             
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527298> : htmlmgrInit: 51 built-in image definitions added                                                 
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527306> : htmlmgrInit: 0 user image definitions added                                                      
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527314> : htmlmgrInit: 14 templates added                                                                  
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527314> : htmlmgrInit: forecast html tags are disabled - /usr/local/etc/wview/forecast.conf not found...   
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527316> : initializing barometric pressure trend                                                           
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527316> : initializing historical stores (this may take some time...)                                      
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527316> : htmlHistoryInit: DAY: samples=0                                                                  
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527325> : htmlHistoryInit: DAY: samples=50
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527333> : htmlHistoryInit: DAY: samples=100
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527341> : htmlHistoryInit: DAY: samples=150
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527349> : htmlHistoryInit: DAY: samples=200
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527357> : htmlHistoryInit: DAY: samples=250
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527364> : htmlHistoryInit: DAY: samples=288
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527364> : htmlHistoryInit: WEEK: samples=0
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527372> : htmlHistoryInit: WEEK: samples=50
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527393> : htmlHistoryInit: WEEK: samples=100
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527401> : htmlHistoryInit: WEEK: samples=150
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527404> : htmlHistoryInit: WEEK: samples=168
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527404> : htmlHistoryInit: MONTH: samples=0
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527412> : htmlHistoryInit: MONTH: samples=50
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527421> : htmlHistoryInit: MONTH: samples=100
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527429> : htmlHistoryInit: MONTH: samples=150
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527437> : htmlHistoryInit: MONTH: samples=200
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527445> : htmlHistoryInit: MONTH: samples=250
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527453> : htmlHistoryInit: MONTH: samples=300
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527461> : htmlHistoryInit: MONTH: samples=350
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527470> : htmlHistoryInit: MONTH: samples=400
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527478> : htmlHistoryInit: MONTH: samples=450
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527486> : htmlHistoryInit: MONTH: samples=500
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527494> : htmlHistoryInit: MONTH: samples=550
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527515> : htmlHistoryInit: MONTH: samples=600
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527523> : htmlHistoryInit: MONTH: samples=650
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527527> : htmlHistoryInit: MONTH: samples=672
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527550> : htmlHistoryInit: YEAR: samples=0
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527578> : htmlHistoryInit: YEAR: samples=50
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527607> : htmlHistoryInit: YEAR: samples=100
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527635> : htmlHistoryInit: YEAR: samples=150
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527664> : htmlHistoryInit: YEAR: samples=200
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527692> : htmlHistoryInit: YEAR: samples=250
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527721> : htmlHistoryInit: YEAR: samples=300
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527749> : htmlHistoryInit: YEAR: samples=350
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527769> : htmlHistoryInit: storing day history for Tue Apr 14 00:05:00 2009
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527783> : htmlHistoryInit: YEAR: samples=365
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527784> : HILOW: OK
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527785> : NOAA DB: OK
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527785> : NOAA: initilizing reports (this may take some time...)
Apr 18 08:48:47 linuxquad htmlgend[11686]: <1240062527785> : NOAA DB: syncing 19700101 => 20090417
Apr 18 08:49:01 linuxquad htmlgend[11686]: <1240062541977> : NOAA DB: done: 4 HILOW records => 1 NOAA records
Apr 18 08:49:02 linuxquad htmlgend[11686]: <1240062542006> : NOAA Generate: creating monthly NOAA reports starting 200904
Apr 18 08:49:02 linuxquad htmlgend[11686]: <1240062542029> : NOAA Generate: creating yearly NOAA reports starting 2009
Apr 18 08:49:02 linuxquad htmlgend[11686]: <1240062542033> : ARCREC: initializing archive browser files (this may take some time...)
Apr 18 08:49:03 linuxquad htmlgend[11686]: <1240062543000> : starting html generation in 1 mins 7 secs
Apr 18 08:49:03 linuxquad htmlgend[11686]: <1240062543000> : doing initial html generation now...
Apr 18 08:49:03 linuxquad htmlgend[11686]: <1240062543113> : Generated: 113 ms: 51 images, 14 template files


24.4  Log Verbosity During Normal Operation

   Configuration Parameter: STATION_VERBOSE_MSGS in wview-conf.sdb

   Log Verbosity refers to status level logs - "normal" operation informational 
   messages. These can be quite interesting when first starting wview or after 
   an upgrade. But when enabled it can generate a bit of log file volume.

   VERBOSE_MSGS controls the default state for all wview daemons at startup.

   While wview is running, you can toggle the log verbosity for a given wview
   daemon by sending a HUP signal to that process (this also causes a reload of
   image/html configuration for htmlgend). Below are the suitable shell commands
   for each daemon:

    kill -s HUP `cat $prefix/var/wview/wviewd.pid`
    kill -s HUP `cat $prefix/var/wview/htmlgend.pid`
    kill -s HUP `cat $prefix/var/wview/wviewftpd.pid`
    kill -s HUP `cat $prefix/var/wview/wviewsshd.pid`
    kill -s HUP `cat $prefix/var/wview/wvalarmd.pid`
    kill -s HUP `cat $prefix/var/wview/wvcwopd.pid`
    kill -s HUP `cat $prefix/var/wview/wvhttpd.pid`


24.5  Vantage Pro

24.5.1  Wireless Reception

   If you are missing archive records, receiving bad archive records, or your 
   current conditions values don't update as expected, you may have problems 
   with the wireless reception from the Vantage Pro Integrated Sensor Suite 
   (ISS). If you have version 1.7.2 or later of wview, you can access a chart 
   which displays the percentage of successful packets received at: 
   http://[your_weather_site_url]/rxcheck.png.
   If the graph displays points equal to zero or at very low values, you should 
   investigate why your wireless reception is so poor. Possible solutions 
   include: changing the gain on your VP Console, moving your VP Console to 
   improve reception or perhaps moving your ISS for better reception.


24.5.2  Serial Interface Problems

   If you see a log message similar to:

daemonStartProcState: lat and long failed

   or periodic logs similar to:

wakeupConsole: Read ERROR!

   or:

wakeupConsole: Invalid data: FE 13     (data values "FE 13" will vary)

   you have a serial interface problem. The best test is to stop wview if it is 
   running and use vpconfig to verify your serial interface.
   
   You should be able to run "vpconfig [device] show" repeatedly without any 
   failures being reported (see section 15.6 for vpconfig usage).
   
   Possible culprits are:
   
   Bad serial cable
   Bad serial port on your PC
   Incorrect terminal server settings (when using a terminal server)
   Improper USB driver installation or operation (if using USB and driver)

   wview will not work properly without a reliable serial interface.

24.6  WXT510

24.6.1  Comm Problems

   If you see error messages like "NMEA: nmea0183Init: XXX failed!" when 
   starting wview, it is a good indication that the comm settings on the WXT510
   have not been set correctly. Be sure you run wxt510config BEFORE your first
   wview start. wxt510config searches through all possible comm setting 
   combinations until it "fimds" the WXT510, then it sets the comm parameters
   properly for wview.

24.6.2  Sensor Problems

   If you see an error similar to:
   "NMEA: nmea0183GetReadings: 0x7FC1: not all sensors updated..."
   then there is the possibility that the THP sensor connector header under the
   very top of the WXT510 is not making good contact. You can remove the long 
   screws which hold the entire station together then remove the 3 very small
   screws which retain the upper PCB cover. Take care to mate the small header 
   in the middle well then hold the cover in place while screwing the retaining
   screws back in. Make sure you do not dislodge the ribbon cable connections.

24.7  Using Extended Sensors

   If you are using extended sensors for your installation be sure that you do 
   not have invalid (not installed) sensor data being generated by htmlgend.
   Check your images.conf file for any enabled sensors which you do not have.
   Uninitialized sensor data can cause htmlgend to crash.

24.8  Using raddebug

   raddebug is a general debug utility which is installed when you install radlib.
   It can be used to display semaphore usage, buffer usage and radmrouted 
   statisitics:
   
       # raddebug 1 $prefix/var/wview

   It will output something like:

Attached to radlib system 1: UP 0 years, 0 months, 0 days, 5 hours, 17 minutes, 26 seconds

Buffer Allocation by Size:
Dumping index 0: size 64: Free/Total 64/64
Dumping index 1: size 128: Free/Total 128/128
Dumping index 2: size 256: Free/Total 244/256
Dumping index 3: size 512: Free/Total 256/256
Dumping index 4: size 1024: Free/Total 128/128
Dumping index 5: size 2048: Free/Total 64/64
Dumping index 6: size 4096: Free/Total 32/32

Buffer Summary:
        Total Free: 916
        Total Allocated: 12
        Total Allocations Since Started: 121628

Semaphore Info:
INDEX   COUNT  WAITERS  ZCNT   PID
  0       0      0        0     0
  1       0      0        0     0
  2       1      0        0     63615
  3       0      0        0     0
  4       1      0        0     61597
  5       0      0        0     0
  6       0      0        0     0
  7       0      0        0     0
  8       0      0        0     0
  9       0      0        0     0
 10       0      0        0     0
 11       0      0        0     0
 12       0      0        0     0
 13       0      0        0     0
 14       0      0        0     0
 15       0      0        0     0

raddebug[63615]: <3310611880> : radlib: raddebug started ...
Dumping message router stats to the system log file...

   Then view the message router (radmrouted) statistics:

       # tail -n 40 -f /var/log/messages

   With output like:

raddebug[63615]: <3310611880> : radlib: raddebug started ...
radmrouted[61576]: <3310611917> : ---------- Message Router Totals:  TX:0000001851  RX:0000001662 ----------
radmrouted[61576]: <3310611917> :      Name       MSGS TX         MSGS RX          TXERRS          RXERRS
radmrouted[61576]: <3310611917> : -------------- ----------      ----------      ----------      ----------
radmrouted[61576]: <3310611917> : wviewd               1021             641               0               0
radmrouted[61576]: <3310611917> : wviewsqld               1              64               0               0
radmrouted[61576]: <3310611917> : wvalarmd                1             318               0               0
radmrouted[61576]: <3310611917> : htmlgend              637             700               0               0
radmrouted[61576]: <3310611917> : wvcwopd                 1              64               0               0
radmrouted[61576]: <3310611917> : wvhttpd               1              64               0               0
radmrouted[61576]: <3310611917> : raddebug                0               0               0               0
radmrouted[61576]: <3310611917> : --------------------------------------------------------------------------

</pre>

</body>
</html>

